$(document).ready(function(){addFadeLayerEvents();$("#BollaResaFuoriVoceForm input:text[name^='resoFuoriVoce']").each(function(){var a=$(this);a.numeric(false);var i=a.val().trim();a.data("oldVal",i)});thumbnailviewer.init();isEdicolaPromo&&disableImagesForPromo($("#popup_name"));$("#BollaResaFuoriVoceForm input[name='resoFuoriVoce']:first").focus()});
function afterSaveResaFuoriVoce(){var a="",i=[],f=0;$($("#BollaResaFuoriVoceForm input:text[name^='resoFuoriVoce']").get().reverse()).each(function(){var e=$("input:hidden[name='cpu']").val(),l=$(this),o=l.attr("id"),d=l.val(),p=l.attr("id"),m=l.attr("id"),n=l.parent().parent();l=n.attr("divParam").split("?")[1].split("=")[1];var b=p.split("|")[4],c=[],u=[],x=0,y=false;p=false;$("#BollaResaTab_table tbody tr[divParam]").each(function(){var s=$(this).attr("divParam").split("?")[1].split("&")[0].split("=")[1];
if(Number(s)==Number(e)){var v=$(this);c[x]=v;s=v.find("input:text[name^='reso']");u[x]=s.attr("id");var w=s.attr("id");if(Number(w.split("|")[4])==Number(o.split("|")[4])){v=v.find("td:nth-child(7)").html().trim();w=w.replace("reso","").replace("resoFuoriVoce","");updateHiddenFields(w,s.val(),v);s.val(d);s.attr("isnewfield","false");i[f]=w;f++;y=true;return false}x++}});if(!y&&c.length>0){for(var r=0,g=0,k=0;k<c.length;k++){var q=u[k].split("|")[4];if(k==0)g=q;if(Number(q)<Number(b)&&Number(q)>Number(r))r=
q}if(r==0&&g>0){r=g;p=true}for(k=0;k<c.length;k++){b=n.clone();q=u[k].split("|")[4];if(q==r){n=c[k].attr("divparam").split("&")[0].split("=")[1];r=c[k].find("td:nth-child(13)").find(".richiamoResaCls").html();q=b.find("td:nth-child(6)").html().trim();g=null;if(isCDL){g=c[k].find("td:nth-child(15)").html();var z=c[k].find("td:nth-child(14)").html();g=getRowHtmlCDL(b,n,r,g,m,d,false,l,z)}else{g=c[k].find("td:nth-child(14)").html();g=getRowHtml(b,n,r,g,m,d,false,l)}if(d!=null&&d!="")a+=addExtraHiddenFields(m,
d,q);if(d!=""&&Number(d)>0){p?$(g).insertBefore(c[k]):$(g).insertAfter(c[k]);$("#content1").css({height:$("#BollaResaForm").height()+30+"px"});i[f]=m.replace("reso","").replace("resoFuoriVoce","");f++;thumbnailviewer.init()}break}}}else if(!y){b=n.clone();g=null;if(isCDL){g=$(b).find("td:nth-child(11)").html();g=getRowHtmlCDL(b,e,"",g,m,d,false,l)}else{g=$(b).find("td:nth-child(10)").html();g=getRowHtml(b,e,"",g,m,d,false,l)}q=b.find("td:nth-child(6)").html().trim();if(d!=null&&d!="")a+=addExtraHiddenFields(m,
d,q);if(d!=""&&Number(d)>0){$(g).insertBefore($("#BollaResaTab_table tbody tr:last"));$("#content1").css({height:$("#BollaResaForm").height()+30+"px"});i[f]=m.replace("reso","").replace("resoFuoriVoce","");f++;thumbnailviewer.init()}}});var t=0;$("#BollaResaTab_table tbody tr[divParam]").each(function(){var e;e=t%2==0?"even":"odd";$(this).removeClass("odd").removeClass("even").addClass(e);$(this).mouseout(function(){$(this).removeClass(e).addClass(e=="even"?"odd":"even")});t++});a!=""&&$("#extraHidden").append(a);
for(var j=0;j<i.length;j++){var h=document.getElementById("reso"+i[j]);$(h).keydown(focusBarcodeField);if(j==0)lastFieldFocusId="reso"+i[j];setTotals(h,true)}setOnChangeEventOnTextFields();setBorderToFuoriVoce();deleteEmptyRowsFuoriVoce();setFocusedFieldStyle();j=$("#BollaResaTab_table tbody").find("td:nth-child(3)");j.unbind("click",tableRowClick);j.css("cursor","pointer").click(tableRowClick);doCloseLayer(function(){if(lastFieldFocusId!=""){var e=lastFieldFocusId.replace(/([|@])/g,"\\$1");e=$("#"+
e);if(!e.is(":disabled")){setLastFocusedElement();e.focus();return false}}})}
function getRowHtml(a,i,f,t,j,h,e,l){h=isNaN(h)?"":Number(h);var o=isNaN(parseLocalNum(a.find("td:nth-child(8)").text().trim()))?"":Number(parseLocalNum(a.find("td:nth-child(8)").text().trim())).toFixed(2),d=isNaN(parseLocalNum(a.find("td:nth-child(9)").text().trim()))?"":Number(parseLocalNum(a.find("td:nth-child(9)").text().trim())).toFixed(4),p=!e?h==""||o==""?"":(Number(h)*Number(o)).toFixed(2):0,m=!e?h==""||d==""?"":(Number(h)*Number(d)).toFixed(4):0,n=j.replace("resoFuoriVoce","").replace("reso",
"");j=j.replace("resoFuoriVoce","reso");var b="<tr class='odd' style='height: 30px;' onmouseover='this.className=\"highlight\"' onmouseout='this.className=\"odd\"' divparam='#?cpu="+i+"' iv='' pv=''>",c=a.find("td:nth-child(2)").text().trim().length>0?"<br/><span class='sottotitoloBolla'>"+a.find("td:nth-child(2)").text()+"</span>":"";f=l.toString()==="true"?msgResaAnticipata+" "+f:f;b+="<td width='2%'>&nbsp;</td>";b+="<td style='text-align: center;' width='4%'>"+i+"</td>";b+="<td style='cursor: pointer;' width='23%'>"+
a.find("td:nth-child(1)").html()+c+"</td>";b+="<td style='text-align: center;' width='4%' style='font-size:12px;'>"+a.find("td:nth-child(3)").html()+"</td>";b+="<td style='text-align: center;' width='5%'>"+a.find("td:nth-child(4)").html()+"</td>";b+="<td style='font-size: 120%; font-weight: bold; text-align: right; border-width: 1px medium; border-style: solid none; border-color: red -moz-use-text-color;' width='5%'><input name='resoFuoriVoce[&#39;"+n+"&#39;]' id='"+j+"' value='"+h+"' isContoDeposito='"+
e+"' style='font-size:120%; font-weight:bold; text-align:right; border-color: rgb(153, 153, 153);' size='2' maxlength='3' validateisnumeric='true' isnewfield='true' type='text'><input type='hidden' name='modificatoFV[&#39;"+n+"&#39;]' id='modificatoFV"+n+"' value='false'/></td>";b+="<td style='text-align: center;' width='5%'>"+a.find("td:nth-child(6)").html()+"</td>";b+="<td style='text-align: center;' style='text-align:center;' width='8%'>"+a.find("td:nth-child(7)").html()+"</td>";b+="<td style='text-align: right;' width='6%'>"+
displayNum(o)+"</td>";b+="<td style='text-align: right;' width='6%'>"+displayNum(d)+"</td>";b+="<td style='text-align: right;' width='7%'>"+p+"</td>";b+="<td style='text-align: right;' width='7%'>"+m+"</td>";b+="<td style='text-align: center;' width='12%'>"+f+"</td>";b+="<td style='text-align: center;' width='4%'>"+t+"</td>";b+="</tr>";return b}
function getRowHtmlCDL(a,i,f,t,j,h,e,l,o){h=isNaN(h)?"":Number(h);var d=isNaN(parseLocalNum(a.find("td:nth-child(8)").text().trim()))?"":Number(parseLocalNum(a.find("td:nth-child(8)").text().trim())).toFixed(2),p=isNaN(parseLocalNum(a.find("td:nth-child(9)").text().trim()))?"":Number(parseLocalNum(a.find("td:nth-child(9)").text().trim())).toFixed(4),m=!e?h==""||d==""?"":(Number(h)*Number(d)).toFixed(2):0,n=!e?h==""||p==""?"":(Number(h)*Number(p)).toFixed(4):0,b=j.replace("resoFuoriVoce","").replace("reso",
"");j=j.replace("resoFuoriVoce","reso");var c="<tr class='odd' style='height: 30px;' onmouseover='this.className=\"highlight\"' onmouseout='this.className=\"odd\"' divparam='#?cpu="+i+"' iv='' pv=''>",u=a.find("td:nth-child(2)").text().trim().length>0?"<br/><span class='sottotitoloBolla'>"+a.find("td:nth-child(2)").text()+"</span>":"";f=l.toString()==="true"?msgResaAnticipata+" "+f:f;o=typeof o==="undefined"?"":o;c+="<td width='2%'>&nbsp;</td>";c+="<td style='text-align: center;' width='4%'>"+i+"</td>";
c+="<td style='cursor: pointer;' width='23%'>"+a.find("td:nth-child(1)").html()+u+"</td>";c+="<td style='text-align: center;' width='4%' style='font-size:12px;'>"+a.find("td:nth-child(3)").html()+"</td>";c+="<td style='text-align: center;' width='5%'>"+a.find("td:nth-child(4)").html()+"</td>";c+="<td style='font-size: 120%; font-weight: bold; text-align: right; border-width: 1px medium; border-style: solid none; border-color: red -moz-use-text-color;' width='5%'><input name='resoFuoriVoce[&#39;"+
b+"&#39;]' id='"+j+"' value='"+h+"' isContoDeposito='"+e+"' style='font-size:120%; font-weight:bold; text-align:right; border-color: rgb(153, 153, 153);' size='2' maxlength='3' validateisnumeric='true' isnewfield='true' type='text'><input type='hidden' name='modificatoFV[&#39;"+b+"&#39;]' id='modificatoFV"+b+"' value='false'/></td>";c+="<td style='text-align: center;' width='5%'>"+a.find("td:nth-child(6)").html()+"</td>";c+="<td style='text-align: center;' style='text-align:center;' width='8%'>"+
a.find("td:nth-child(7)").html()+"</td>";c+="<td style='text-align: right;' width='6%'>"+displayNum(d)+"</td>";c+="<td style='text-align: right;' width='6%'>"+displayNum(p)+"</td>";c+="<td style='text-align: right;' width='7%'>"+m+"</td>";c+="<td style='text-align: right;' width='7%'>"+n+"</td>";c+="<td style='text-align: center;' width='12%'>"+f+"</td>";c+="<td style='text-align: center;' width='5%'>"+o+"</td>";c+="<td style='text-align: center;' width='4%'>"+t+"</td>";c+="</tr>";return c}
function addExtraHiddenFields(a,i,f){a=a.replace("reso","").replace("resoFuoriVoce","");return"<input type='hidden' id='reso_old_"+a+"' value='"+i+"'/>"+("<input type='hidden' id='giacenza_old_"+a+"' value='"+f+"'/>")}function updateHiddenFields(a,i,f){document.getElementById("reso_old_"+a).value=i;document.getElementById("giacenza_old_"+a).value=f};