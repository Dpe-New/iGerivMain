<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:p="http://www.springframework.org/schema/p"
	xmlns:context="http://www.springframework.org/schema/context"
	xmlns:jee="http://www.springframework.org/schema/jee" xmlns:aop="http://www.springframework.org/schema/aop"
	xmlns:tx="http://www.springframework.org/schema/tx"
	xsi:schemaLocation="
	   http://www.springframework.org/schema/beans
	   http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
	   http://www.springframework.org/schema/context
	   http://www.springframework.org/schema/context/spring-context-3.0.xsd
	   http://www.springframework.org/schema/jee
	   http://www.springframework.org/schema/jee/spring-jee-3.0.xsd
	   http://www.springframework.org/schema/aop
	   http://www.springframework.org/schema/aop/spring-aop-3.0.xsd
	   http://www.springframework.org/schema/tx
	   http://www.springframework.org/schema/tx/spring-tx-3.0.xsd"
	default-autowire="no">

	<context:annotation-config />
	<context:component-scan
		base-package="it.dpe.igeriv.exchange.ftp.impl,
  										  it.dpe.igeriv.security.openid,
  										  it.dpe.igeriv.security,
  										  it.dpe.igeriv.vendite.inputmodulelistener.impl,
  										  it.dpe.igeriv.web.actions,
  										  it.dpe.igeriv.web.listener,
  										  it.dpe.service.mail.impl,
  										  it.dpe.ws.client" />

	<!-- Datasource Connection -->
	<bean id="dataSource" class="com.mchange.v2.c3p0.ComboPooledDataSource"
		destroy-method="close">
		<property name="driverClass">
			<value>${plg.db.driverClassName}</value>
		</property>
		<property name="jdbcUrl">
			<value>${plg.db.url}</value>
		</property>
		<property name="user">
			<value>${plg.db.user}</value>
		</property>
		<property name="password">
			<value>${plg.db.password}</value>
		</property>
		<property name="autoCommitOnClose">
			<value>true</value>
		</property>
		<property name="checkoutTimeout">
			<value>5000</value>
		</property>
	</bean>

	<!-- Hibernate Configuration -->
	<bean id="sessionFactory"
		class="org.springframework.orm.hibernate3.annotation.AnnotationSessionFactoryBean">
		<property name="dataSource" ref="dataSource" />

		<property name="packagesToScan">
			<list>
				<value>it.dpe.igeriv.vo</value>
			</list>
		</property>

		<property name="hibernateProperties">
			<props>
				<prop key="hibernate.dialect">${plg.db.hibernate.dialect}</prop>
				<prop key="hibernate.connection.autocommit">${plg.db.hibernate.autocommit}</prop>
				<prop key="hibernate.show_sql">${plg.db.hibernate.show_sql}</prop>
				<prop key="hibernate.format_sql">${plg.db.hibernate.format_sql}</prop>
				<prop key="hibernate.use_sql_comments">${plg.db.hibernate.use_sql_comments}</prop>
				<prop key="hibernate.default_entity_mode">pojo</prop>
				<prop key="hibernate.connection.release_mode">after_statement</prop>
				<prop key="hibernate.c3p0.acquire_increment">1</prop>
				<prop key="hibernate.c3p0.min_size">10</prop>
				<prop key="hibernate.c3p0.max_size">100</prop>
				<prop key="hibernate.c3p0.timeout">100</prop>
				<prop key="hibernate.c3p0.max_statements">0</prop>
				<prop key="hibernate.c3p0.idle_test_period">100</prop>
				

			</props>
		</property>
	</bean>

	<!-- Spring/Hibernate Configuration -->
	<bean id="hibernateTemplate" class="org.springframework.orm.hibernate3.HibernateTemplate">
		<constructor-arg>
			<ref bean="sessionFactory" />
		</constructor-arg>
	</bean>

	<bean id="dpeTransactionManager"
		class="org.springframework.orm.hibernate3.HibernateTransactionManager">
		<property name="sessionFactory" ref="sessionFactory" />
	</bean>

	<bean id="contextApplicationContextProvider" class="it.dpe.igeriv.util.ApplicationContextProvider"></bean>

	<!-- External properties file configuration -->
	<bean id="igerivProperties"
		class="it.dpe.igeriv.web.resources.ExposablePropertyPaceholderConfigurer">
		<property name="location">
			<value>file:/C:/igeriv/iGeriv.properties</value>
		</property>
	</bean>

	<bean id="mailSession" class="javax.mail.Session" factory-method="getInstance">
		<constructor-arg>
			<props>
				<prop key="mail.smtp.host">127.0.0.1</prop>
				<prop key="mail.smtp.port">25</prop>
			</props>
		</constructor-arg>
	</bean>

	<bean id="JavaMailSender" class="org.springframework.mail.javamail.JavaMailSenderImpl">
		<property name="host" value="${smtpHost}" />
		<property name="port" value="${smtpPort}" />
		<property name="username" value="${userName}" />
		<property name="password" value="${password}" />
		<property name="session" ref="mailSession" />
	</bean>

	<!-- Mail message templates -->
	<bean id="IGerivMessage" class="org.springframework.mail.SimpleMailMessage">
		<property name="from">
			<value><![CDATA[${igeriv.app.name} - Monitor <noreply@geriv.it>]]></value>
		</property>
		<property name="to">
			<list>
				<!-- Cancellare per deploy in produzione -->
				<value><![CDATA[Marcello Romano <marcello.romano@dpe.it>]]></value>
			</list>
		</property>
		<property name="subject" value="${igeriv.app.name}" />
	</bean>

	<bean id="org.apache.struts2.dispatcher.ServletDispatcherResult"
		class="org.apache.struts2.dispatcher.ServletDispatcherResult" scope="prototype"
		autowire="byName">
	</bean>

	<!-- Spring AOP Logging -->
	<!-- <bean id="LoggingAspect" class="it.dpe.logging.ServiceLayerLoggingAspect" 
		/> <aop:config> <aop:aspect ref="LoggingAspect"> <aop:pointcut id="myCutLogging" 
		expression="execution(* it.dpe..*Bo.*(..)) || execution(* it.dpe..*Facade.*(..)) 
		|| execution(* it.dpe..*Service.*(..)) || execution(* it.dpe..*Listener.*(..)) 
		|| execution(* it.dpe..*Job.*(..))" /> <aop:around pointcut-ref="myCutLogging" 
		method="log" /> </aop:aspect> </aop:config> -->

	<bean id="LoggingAspect" class="it.dpe.logging.ServiceLayerLoggingAspect" />
	<aop:config>
		<aop:aspect ref="LoggingAspect">
			<aop:pointcut id="myCutLogging" expression="execution(* it.dpe..*Service.*(..))" />
			<aop:around pointcut-ref="myCutLogging" method="log" />
		</aop:aspect>
	</aop:config>

	<!-- Spring AOP Transactions -->
	<tx:advice id="txAdvice" transaction-manager="dpeTransactionManager">
		<tx:attributes>
			<tx:method name="read*" propagation="REQUIRED" />
			<tx:method name="create*" propagation="REQUIRED" />
			<tx:method name="insert*" propagation="REQUIRED" />
			<tx:method name="update*" propagation="REQUIRED" />
			<tx:method name="save*" propagation="REQUIRED" />
			<tx:method name="delete*" propagation="REQUIRED" />
			<tx:method name="execute*" propagation="REQUIRED" />
		</tx:attributes>
	</tx:advice>

	<tx:advice id="importTxAdviceInforiv" transaction-manager="dpeTransactionManager">
		<tx:attributes>
			<tx:method name="import*" propagation="REQUIRED" />
			<tx:method name="update*" propagation="REQUIRED" />
		</tx:attributes>
	</tx:advice>

	<aop:config>
		<aop:pointcut id="serviceOperation" expression="execution(* it.dpe..*Service.*(..))" />
		<aop:pointcut id="importInforivOperation"
			expression="execution(* it.dpe..*InforivImportBo.*(..))" />
		<aop:advisor pointcut-ref="serviceOperation" advice-ref="txAdvice" />
		<aop:advisor pointcut-ref="importInforivOperation"
			advice-ref="importTxAdviceInforiv" />
	</aop:config>

	<!-- Monitoring -->
	<!-- Esclusione Melody 04-11-19
	<bean id="facadeMonitoringAdvisor" class="net.bull.javamelody.MonitoringSpringAdvisor">
		<property name="pointcut">
			<bean class="org.springframework.aop.support.JdkRegexpMethodPointcut">
				<property name="pattern" value="it.dpe.igeriv.bo.*Service.*" />
			</bean>
		</property>
	</bean>
	-->

	<!-- JCaptcha Custom Beans -->

	<bean id="colorBlue" class="java.awt.Color">
		<constructor-arg index="0">
			<value>0</value>
		</constructor-arg>
		<constructor-arg index="1">
			<value>0</value>
		</constructor-arg>
		<constructor-arg index="2">
			<value>1</value>
		</constructor-arg>
	</bean>

	<bean id="simpleWhitePaster"
		class="com.octo.captcha.component.image.textpaster.RandomTextPaster">
		<constructor-arg type="java.lang.Integer" index="0">
			<value>5</value>
		</constructor-arg>
		<constructor-arg type="java.lang.Integer" index="1">
			<value>8</value>
		</constructor-arg>
		<constructor-arg type="java.awt.Color" index="2">
			<ref bean="colorBlue" />
		</constructor-arg>
	</bean>


	<bean id="backGenUni"
		class="com.octo.captcha.component.image.backgroundgenerator.UniColorBackgroundGenerator">
		<constructor-arg index="0">
			<value>300</value>
		</constructor-arg>
		<constructor-arg index="1">
			<value>100</value>
		</constructor-arg>
	</bean>


	<bean id="fontArial" class="java.awt.Font">
		<constructor-arg index="0">
			<value>Arial</value>
		</constructor-arg>
		<constructor-arg index="1">
			<value>0</value>
		</constructor-arg>
		<constructor-arg index="2">
			<value>20</value>
		</constructor-arg>
	</bean>

	<bean id="fontTimes" class="java.awt.Font">
		<constructor-arg index="0">
			<value>Times New Roman</value>
		</constructor-arg>
		<constructor-arg index="1">
			<value>0</value>
		</constructor-arg>
		<constructor-arg index="2">
			<value>20</value>
		</constructor-arg>
	</bean>

	<bean id="fontComic" class="java.awt.Font">
		<constructor-arg index="0">
			<value>Comic Sans MS</value>
		</constructor-arg>
		<constructor-arg index="1">
			<value>0</value>
		</constructor-arg>
		<constructor-arg index="2">
			<value>20</value>
		</constructor-arg>
	</bean>


	<bean id="fontGenRandom"
		class="com.octo.captcha.component.image.fontgenerator.RandomFontGenerator">
		<constructor-arg index="0">
			<value>30</value>
		</constructor-arg>
		<constructor-arg index="1">
			<value>60</value>
		</constructor-arg>
		<constructor-arg index="2">
			<list>
				<ref bean="fontArial" />
				<ref bean="fontTimes" />
				<ref bean="fontComic" />
			</list>
		</constructor-arg>
	</bean>


	<bean id="wordtoimage"
		class="com.octo.captcha.component.image.wordtoimage.ComposedWordToImage">
		<constructor-arg index="0">
			<ref bean="fontGenRandom" />
		</constructor-arg>
		<constructor-arg index="1">
			<ref bean="backGenUni" />
		</constructor-arg>
		<constructor-arg index="2">
			<ref bean="simpleWhitePaster" />
		</constructor-arg>
	</bean>


	<bean id="filedict" class="com.octo.captcha.component.word.FileDictionary">
		<constructor-arg index="0">
			<value>toddlist</value>
		</constructor-arg>
	</bean>

	<bean id="wordgen"
		class="com.octo.captcha.component.word.wordgenerator.DictionaryWordGenerator">
		<constructor-arg>
			<ref bean="filedict" />
		</constructor-arg>
	</bean>

	<bean id="CaptchaFactory" class="com.octo.captcha.image.gimpy.GimpyFactory">
		<constructor-arg>
			<ref bean="wordgen" />
		</constructor-arg>
		<constructor-arg>
			<ref bean="wordtoimage" />
		</constructor-arg>
	</bean>

	<bean id="imageEngine" class="com.octo.captcha.engine.GenericCaptchaEngine">
		<constructor-arg index="0">
			<list>
				<ref bean="CaptchaFactory" />
			</list>
		</constructor-arg>
	</bean>

	<bean id="iGerivCaptchaService"
		class="com.octo.captcha.service.image.DefaultManageableImageCaptchaService">
		<constructor-arg index="0">
			<bean class="com.octo.captcha.service.captchastore.FastHashMapCaptchaStore" />
		</constructor-arg>
		<constructor-arg index="1">
			<ref bean="imageEngine" />
		</constructor-arg>
		<constructor-arg index="2">
			<value>180</value>
		</constructor-arg>
		<constructor-arg index="3">
			<value>100000</value>
		</constructor-arg>
		<constructor-arg index="4">
			<value>75000</value>
		</constructor-arg>
	</bean>

	<bean id="jc4s2config" class="com.google.code.jcaptcha4struts2.core.beans.JC4S2Config"
		factory-method="getInstance">
		<property name="imageCaptchaService" ref="iGerivCaptchaService" />
	</bean>

</beans>