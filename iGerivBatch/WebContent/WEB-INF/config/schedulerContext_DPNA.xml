<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:p="http://www.springframework.org/schema/p"
	xmlns:context="http://www.springframework.org/schema/context"
	xmlns:jee="http://www.springframework.org/schema/jee" xmlns:aop="http://www.springframework.org/schema/aop"
	xmlns:tx="http://www.springframework.org/schema/tx"
	xmlns:int-jmx="http://www.springframework.org/schema/integration/jmx"
	xsi:schemaLocation="
	   http://www.springframework.org/schema/beans
	   http://www.springframework.org/schema/beans/spring-beans.xsd
	   http://www.springframework.org/schema/context
	   http://www.springframework.org/schema/context/spring-context.xsd
	   http://www.springframework.org/schema/jee
	   http://www.springframework.org/schema/jee/spring-jee.xsd
	   http://www.springframework.org/schema/aop
	   http://www.springframework.org/schema/aop/spring-aop.xsd
	   http://www.springframework.org/schema/tx
	   http://www.springframework.org/schema/tx/spring-tx.xsd
	   http://www.springframework.org/schema/integration/jmx
	   http://www.springframework.org/schema/integration/jmx/spring-integration-jmx.xsd"
	default-autowire="no">
	
	<context:mbean-server id="mbeanServer" />
	<int-jmx:mbean-export id="mBeanExport" default-domain="igeriv.batch" />
	
	<!-- 
		Scheduler che:
		1. Cancella dal file system le immagini i cui nomi non sono presenti nelle tabelle dei prodotti vari (categorie/sottocategorie/prodotti).  
		2. Cancella le bolle di carico dei prodotti vari delle edicola precedenti a x giorni leggendo il parametro per ogni edicola.  
	 --> 
	<bean id="manutenzioneTabelleProdottiVariScheduler" class="org.springframework.scheduling.quartz.SchedulerFactoryBean">
		<property name="triggers">
			<list>
				<ref bean="manutenzioneTabelleProdottiVariCronTrigger" />
			</list>
		</property>
	</bean>
	<bean id="manutenzioneTabelleProdottiVariCronTrigger" class="org.springframework.scheduling.quartz.CronTriggerFactoryBean">
		<property name="jobDetail" ref="manutenzioneTabelleProdottiVariJobDetail" />
		<property name="cronExpression" value="${igeriv.manutenzione.tabelle.prodotti.vari.cron.expr}" />
	</bean>

	<bean name="manutenzioneTabelleProdottiVariJobDetail" class="org.springframework.scheduling.quartz.JobDetailFactoryBean">
		<property name="jobClass" value="it.dpe.igeriv.job.IGerivManutenzioneTabelleProdottiVariJob" />
      	<property name="jobDataAsMap">
			<map>
				<entry key="iGerivBatchBo" value-ref="IGerivBatchService" />
				<entry key="mailingListService" value-ref="MailingListService" />
				<entry key="timeout" value="5000" />
			</map>
		</property>
	</bean>
	
	<!-- Da usare per test -->
	<!-- 
	<bean id="JmsService" class="it.dpe.igeriv.jms.service.impl.JmsServiceImpl">
		<property name="bo">	
			<bean class="it.dpe.igeriv.bo.MockIgerivBatchBoImpl"/>
		</property>	
	</bean>
	-->
	
	<!-- Esportazione richieste rifornimento prodotti vari dei DL via JMS -->
	<!-- 
	<bean id="prodottiExportCronTriggerScheduler" class="org.springframework.scheduling.quartz.SchedulerFactoryBean">
		<property name="triggers">
			<list>
				<ref bean="prodottiExportCronTrigger" />
			</list>
		</property>
	</bean>
	
	<bean id="prodottiExportCronTrigger" class="org.springframework.scheduling.quartz.CronTriggerFactoryBean">
		<property name="jobDetail" ref="prodottiExportJobDetail" />		
		<property name="cronExpression" value="${igeriv.esportazione.richieste.rifornimento.cron.expr}" />
	</bean>

	<bean name="prodottiExportJobDetail" class="org.springframework.scheduling.quartz.JobDetailFactoryBean">
		<property name="jobClass" value="it.dpe.igeriv.job.IGerivJmsRichiesteRifornimentoExportJob" />
      	<property name="jobDataAsMap">
			<map>
				<entry key="sendGateway" value-ref="sendGateway" />
				<entry key="jmsService" value-ref="JmsService" />
				<entry key="mailingListService" value-ref="MailingListService" />
				<entry key="timeout" value="5000" />
			</map>
		</property>
	</bean>
	-->
	
	<!-- Esportazione bolle di resa prodotti vari dei DL via JMS -->
	<!-- 
	<bean id="bolleResaProdottiVariExportCronTriggerScheduler" class="org.springframework.scheduling.quartz.SchedulerFactoryBean">
		<property name="triggers">
			<list>
				<ref bean="resaExportCronTrigger" />
			</list>
		</property>
	</bean>
	
	<bean id="resaExportCronTrigger" class="org.springframework.scheduling.quartz.CronTriggerFactoryBean">
		<property name="jobDetail" ref="resaExportJobDetail" />		
		<property name="cronExpression" value="${igeriv.esportazione.bolle.resa.prodotti.vari.dl.cron.expr}" />
	</bean>

	<bean name="resaExportJobDetail" class="org.springframework.scheduling.quartz.JobDetailFactoryBean">
		<property name="jobClass" value="it.dpe.igeriv.job.IGerivJmsBolleResaProdottiVariExportJob" />
      	<property name="jobDataAsMap">
			<map>
				<entry key="sendGateway" value-ref="sendGateway" />
				<entry key="jmsService" value-ref="JmsService" />
				<entry key="mailingListService" value-ref="MailingListService" />
				<entry key="timeout" value="5000" />
			</map>
		</property>
	</bean>
	-->
	
	<!-- Rinomina i file delle bolle che sono andate in errore (toglie il suffisso ._ERR) per al massimo 3 volte -->
	<bean id="renameBolleInErroreCronTriggerScheduler" class="org.springframework.scheduling.quartz.SchedulerFactoryBean">
		<property name="triggers">
			<list>
				<ref bean="renameBolleInErroreCronTrigger" />
			</list>
		</property>
	</bean>
	
	<bean id="renameBolleInErroreCronTrigger" class="org.springframework.scheduling.quartz.CronTriggerFactoryBean">
		<property name="jobDetail" ref="renameBolleInErroreJobDetail" />		
		<property name="cronExpression" value="${igeriv.rename.bolle.in.errore.cron.expr}" />
	</bean>

	<bean name="renameBolleInErroreJobDetail" class="org.springframework.scheduling.quartz.JobDetailFactoryBean">
		<property name="jobClass" value="it.dpe.igeriv.job.IGerivRenameBolleInErroreJob" />
      	<property name="jobDataAsMap">
			<map>
				<entry key="agenzieService" value-ref="AgenzieService" />
				<entry key="mailingListService" value-ref="MailingListService" />
				<entry key="datiPathDir" value="${dl.path.dir.dati.in}" />
				<entry key="logPathDir" value="${igeriv.log.path}" />
				<entry key="timeout" value="5000" />
			</map>
		</property>
	</bean>
	 
	<!-- Esportazione fatture e estratti conto -->
	<!--
	<bean id="fattureEstrattiContoCronTriggerScheduler" class="org.springframework.scheduling.quartz.SchedulerFactoryBean">
		<property name="triggers">
			<list>
				<ref bean="fattureEstrattiContoExportCronTrigger" />
			</list>
		</property>
	</bean>
	
	<bean id="fattureEstrattiContoExportCronTrigger" class="org.springframework.scheduling.quartz.CronTriggerFactoryBean">
		<property name="jobDetail" ref="fattureEstrattiContoExportJobDetail" />		
		<property name="cronExpression" value="0 0/1 * * * ?" />
	</bean>

	<bean name="fattureEstrattiContoExportJobDetail" class="org.springframework.scheduling.quartz.JobDetailFactoryBean">
		<property name="jobClass" value="it.dpe.igeriv.job.FattureECExporter" />
      	<property name="jobDataAsMap">
			<map>
				<entry key="dao" value-ref="BaseDao" />
				<entry key="iGerivService" value-ref="IGerivSecureService" />
				<entry key="pathEstrattiContoClienti" value="${path.estratti.conto.clienti}" />
				<entry key="pathFatture" value="${path.fatture.edicole}" />
				<entry key="timeout" value="5000" />
			</map>
		</property>
	</bean>
 	-->
</beans>