<%@ taglib prefix="s" uri="/struts-tags"%>
<%@ page trimDirectiveWhitespaces="true"%>

<style type="text/css">
<!--

	
	.bqy_no {
		font-size: 8px;
	}
	
	.hide_img1 {
		display: none;
	}
	.hide_img2 {
		display: none;
	}
	.hide_img3 {
		display: none;
	}
	.hide_img4 {
		display: none;
	}
	.hide_img5 {
		display: none;
	}
	.hide_img6 {
		display: none;
	}
	.hide_img7 {
		display: none;
	}
	.hide_img8 {
		display: none;
	}
	.hide_img9 {
		display: none;
	}
	.hide_img10 {
		display: none;
	}
	.hide_img11 {
		display: none;
	}
	.hide_img12 {
		display: none;
	}
		
	.hide_img1 {
		background: none repeat scroll 0 0 #063D7E;
		border: 6px solid #000000;
		border-radius: 4px 4px 4px 4px;
		color: #78C102;
		height: 100px;
		margin-left: 12px;
		margin-top: 14px;
		position: absolute;
		width: 192px;
	}
	.hide_img2 {
		background: none repeat scroll 0 0 #063D7E;
		border: 6px solid #000000;
		border-radius: 4px 4px 4px 4px;
		color: #78C102;
		height: 100px;
		margin-left: 12px;
		margin-top: 14px;
		position: absolute;
		width: 192px;
	}
	.hide_img3 {
		background: none repeat scroll 0 0 #063D7E;
		border: 6px solid #000000;
		border-radius: 4px 4px 4px 4px;
		color: #78C102;
		height: 100px;
		margin-left: 12px;
		margin-top: 14px;
		position: absolute;
		width: 192px;
	}
	.hide_img4 {
		background: none repeat scroll 0 0 #063D7E;
		border: 6px solid #000000;
		border-radius: 4px 4px 4px 4px;
		color: #78C102;
		height: 100px;
		margin-left: 12px;
		margin-top: 14px;
		position: absolute;
		width: 192px;
	}
	.hide_img5 {
		background: none repeat scroll 0 0 #063D7E;
		border: 6px solid #000000;
		border-radius: 4px 4px 4px 4px;
		color: #78C102;
		height: 100px;
		margin-left: 12px;
		margin-top: 14px;
		position: absolute;
		width: 192px;
	}
	.hide_img6 {
		background: none repeat scroll 0 0 #063D7E;
		border: 6px solid #000000;
		border-radius: 4px 4px 4px 4px;
		color: #78C102;
		height: 100px;
		margin-left: 12px;
		margin-top: 14px;
		position: absolute;
		width: 192px;
	}
	.hide_img7 {
		background: none repeat scroll 0 0 #063D7E;
		border: 6px solid #000000;
		border-radius: 4px 4px 4px 4px;
		color: #78C102;
		height: 100px;
		margin-left: 12px;
		margin-top: 14px;
		position: absolute;
		width: 192px;
	}
	.hide_img8 {
		background: none repeat scroll 0 0 #063D7E;
		border: 6px solid #000000;
		border-radius: 4px 4px 4px 4px;
		color: #78C102;
		height: 100px;
		margin-left: 12px;
		margin-top: 14px;
		position: absolute;
		width: 192px;
	}
	.hide_img9 {
		background: none repeat scroll 0 0 #063D7E;
		border: 6px solid #000000;
		border-radius: 4px 4px 4px 4px;
		color: #78C102;
		height: 100px;
		margin-left: 12px;
		margin-top: 14px;
		position: absolute;
		width: 192px;
	}
	.hide_img10 {
		background: none repeat scroll 0 0 #063D7E;
		border: 6px solid #000000;
		border-radius: 4px 4px 4px 4px;
		color: #78C102;
		height: 100px;
		margin-left: 12px;
		margin-top: 14px;
		position: absolute;
		width: 192px;
	}
	.hide_img11 {
		background: none repeat scroll 0 0 #063D7E;
		border: 6px solid #000000;
		border-radius: 4px 4px 4px 4px;
		color: #78C102;
		height: 100px;
		margin-left: 12px;
		margin-top: 14px;
		position: absolute;
		width: 192px;
	}
	.hide_img12 {
		background: none repeat scroll 0 0 #063D7E;
		border: 6px solid #000000;
		border-radius: 4px 4px 4px 4px;
		color: #78C102;
		height: 100px;
		margin-left: 12px;
		margin-top: 14px;
		position: absolute;
		width: 192px;
	}
	
	a.show_img1:hover + .hide_img1 {
		display: block;
		color: #78C102;
	}
	a.show_img2:hover + .hide_img2 {
		display: block;
		color: #78C102;
	}
	a.show_img3:hover + .hide_img3 {
		display: block;
		color: #78C102;
	}
	a.show_img4:hover + .hide_img4 {
		display: block;
		color: #78C102;
	}
	a.show_img5:hover + .hide_img5 {
		display: block;
		color: #78C102;
	}
	a.show_img6:hover + .hide_img6 {
		display: block;
		color: #78C102;
	}
	a.show_img7:hover + .hide_img7 {
		display: block;
		color: #78C102;
	}
	a.show_img8:hover + .hide_img8 {
		display: block;
		color: #78C102;
	}
	a.show_img9:hover + .hide_img9 {
		display: block;
		color: #78C102;
	}
	a.show_img10:hover + .hide_img10 {
		display: block;
		color: #78C102;
	}
	a.show_img11:hover + .hide_img11 {
		display: block;
		color: #78C102;
	}
	a.show_img12:hover + .hide_img12 {
		display: block;
		color: #78C102;
	}

-->
</style>




<script>
	var deleted = false;
	
	
	$(document).ready(function() {	
		addFadeLayerEvents();
		openPopupDettaglioDisableLogo();
		
		if($("#sceltaCopertina_js").val() !== 'undefined' && $("#sceltaLogo_js").val() !== 'undefined'){
		  //Scelta copertina
		  var val_copertina ="";
		  var $radios = $('input:radio[name=sceltaCopertina]');
		  if($('#sceltaCopertina_js').val() == 1){
			  val_copertina = '[value="true"]';
			  opernPopupModificaAbilitaCopertina();
		  }else{
			  val_copertina = '[value="false"]';
		  }
		  $radios.filter(val_copertina).attr('checked', true);
	      
		  //Scelta logo
	      var $radios_logo = $('input:radio[name=sceltaLogo]'); 
	      var val = "[value=\""+$('#sceltaLogo_js').val()+"\"]";
             $radios_logo.filter(val).attr('checked', true);
		}
			
		
		$('input[type=radio][name=sceltaCopertina]').change(function() {
	        if (this.value == 'true') {
	            $("#copertina_primariga").attr("disabled", "");
	            $("#copertina_secondariga").attr("disabled", "");
	            $("#copertina_terzariga").attr("disabled", "");
	            $('input[type=radio][name=sceltaLogo]').attr("disabled", "");
	            
	            if($('#TOMI').val()!= null && $('#TOMI').val()!= '0'){
	            	var costoCopertinaPerTomi = 1.50*$('#TOMI').val();
	            	var costoCopertinaPerTomi_format = parseFloat(costoCopertinaPerTomi).toFixed(2);
	            	$("#strCostoCopertinatura").text("IL PREZZO AL PUBBLICO E\' DI "+costoCopertinaPerTomi_format+" Euro");
	            	$("#costoCopertinatura").val(costoCopertinaPerTomi);
	            	
	            }else if($('#TOMI').val()!= null && $('#TOMI').val()<= '0'){
	            	var costoCopertinaPerTomi = 1.50;
	            	var costoCopertinaPerTomi_format = parseFloat(costoCopertinaPerTomi).toFixed(2);
	            	$("#strCostoCopertinatura").text("IL PREZZO AL PUBBLICO E\' DI "+costoCopertinaPerTomi_format+" Euro");
	            	$("#costoCopertinatura").val(costoCopertinaPerTomi);
	            }
	            
	            
	           
	            $("#recuperaInfo").show();
	        }
	        else if (this.value == 'false') {
	        	$("#copertina_primariga").attr("value", "");
	            $("#copertina_primariga").attr("disabled", "disabled");
	            $("#copertina_secondariga").attr("value", "");
	            $("#copertina_secondariga").attr("disabled", "disabled");
	            $("#copertina_terzariga").attr("value", "");
	            $("#copertina_terzariga").attr("disabled", "disabled");
	            $('input[type=radio][name=sceltaLogo]').attr("disabled", "disabled");
	            $('input[type=radio][name=sceltaLogo]:checked').removeAttr("checked");
	            $("#strCostoCopertinatura").text("");
	            $("#recuperaInfo").hide();
	        }
	    });
		
		
		
		
	});		
	
	
	
	function validateForm(){
	
		if($('input[type=radio][name=sceltaCopertina]:checked').val() == 'true'){
			//Tre righe per il testo
			if($("#copertina_primariga").val().trim().lenght === undefined 
				&& $("#copertina_secondariga").val().trim().lenght === undefined 
				&& $("#copertina_terzariga").val().trim().lenght === undefined ){
				//Scelta del logo
// 				if($('input[type=radio][name=sceltaLogo]:checked').val() === undefined){
// 					$.alerts.dialogClass = "style_1";
// 					jAlert("Per l\'applicazione della copertina al libro, deve essere inserito almeno un testo o scelto un logo", attenzioneMsg.toUpperCase(), function() {
// 						$("#copertina_primariga").focus();
// 					});
// 					return false;
// 				}
			}
            
		}
		
		//addCart(function() {clienteEdicolaSuccessCallback();});
		addCart(function() {viewMsgAddCartOk();});
	}
	
	function addCart(callback) {
		setTimeout(function() {
			setFormAction('popupDettaglioLibroForm','libriScolasticiClienti_addCartClesp.action', '', '', true, '', function() {
				if (typeof(callback) === 'function') {
					callback();
					$('#testoRicerca').val("");
					$('#ricerca').trigger('click');	 
					$('.errorMessage').hide();
				}
			}, 
			function() {
				return validateFieldsClienteEdicola(true);
			}, false, '');
		}, 100);
		
	}
	
	function recuperaInfoCopertinaPrecedente() {
		
			var idNumeroOrdine = $("#idNumeroOrdine").val();
			ray.ajax();
    		dojo.xhrGet({
    			url: "${pageContext.request.contextPath}/pubblicazioniRpc_infoCopertinaUltimoLibro.action?idNumeroOrdine="+idNumeroOrdine,	
    			handleAs: "json",				
    			headers: { "Content-Type": "application/json; charset=uft-8"}, 	
    			preventCache: true,
    			handle: function(data,args) {
    				unBlockUI();
						if (args.xhr.status == 200) {
							if(data.length>0){
								for (i = 0; i < data.length; i++) {
									
									  var fgCopertina = data[i].fgCopertina;
									  var primaRiga = data[i].primaRiga;
									  var secondaRiga = data[i].secondaRiga;
									  var terzaRiga = data[i].terzaRiga;
									  var idLogo = data[i].idLogo;
									
									  //Scelta copertina si/no
									  var $radios = $('input:radio[name=sceltaCopertina]');
									  if(fgCopertina == 1){
										  val_copertina = '[value="true"]';
										  opernPopupModificaAbilitaCopertina();
									  }else{
										  val_copertina = '[value="false"]';
									  }
									  $radios.filter(val_copertina).attr('checked', true);	
																	
									  //Scelta logo
								      var $radios_logo = $('input:radio[name=sceltaLogo]'); 
								      var val = "[value=\""+idLogo+"\"]";
							          $radios_logo.filter(val).attr('checked', true);
									
							          $("#copertina_primariga").attr("value", primaRiga);
							          $("#copertina_secondariga").attr("value", secondaRiga);
							          $("#copertina_terzariga").attr("value", terzaRiga);
								}
						          
							}else{
								$.alerts.dialogClass = "style_1";
								jAlert("<s:text name='msg.errore.info.ultima.copertina.inserita'/>", attenzioneMsg.toUpperCase(), function() {
									$.alerts.dialogClass = null;
									return false;
								});
							}
						}else {
							$.alerts.dialogClass = "style_1";
							jAlert("<s:text name='msg.errore.info.copertina.libro'/>", attenzioneMsg.toUpperCase(), function() {
								$.alerts.dialogClass = null;
								return false;
							});
						} 
    				
    				
    				}
    		 	});
	}
	
	
	function viewMsgAddCartOk(){
		jAlert("<s:text name='gp.dati.memorizzati'/>", infoCopertina.toUpperCase(),'');
	}
	
	function clienteEdicolaSuccessCallback() {
	
		jConfirm("<s:text name='gp.dati.memorizzati'/><br><s:text name='gp.vuoi.inserire.prenotazioni.per.questo.cliente'/>", attenzioneMsg, 
			function(r) {
				if (r) {
					if (cod.length > 0 && cod != '' && nome.length > 0 && nome != '') {
						<s:url action="prenotazioneClienti_showFilter.action" var="urlTag"/>
						window.location = '<s:property value="#urlTag" />?idCliente=' + cod + '&nomeCliente=' + nome + ' ' + cognome;
					}
				} else {
					$("#ricerca").trigger("click");
				}
		}, true, false);
		setTimeout(function() {
			$("#popup_ok").focus();
		}, 100);
	}		

	
	function validateFieldsClienteEdicola(showAlerts) {
		return true;
	}
	
	function openPopupDettaglioDisableLogo(){
		
		$("#copertina_primariga").attr("disabled", "disabled");
        $("#copertina_secondariga").attr("disabled", "disabled");
        $("#copertina_terzariga").attr("disabled", "disabled");
        $('input[type=radio][name=sceltaLogo]').attr("disabled", "disabled");
        $("#recuperaInfo").hide();
	}
	
	function opernPopupModificaAbilitaCopertina(){
		$("#copertina_primariga").attr("disabled", "");
        $("#copertina_secondariga").attr("disabled", "");
        $("#copertina_terzariga").attr("disabled", "");
        $('input[type=radio][name=sceltaLogo]').attr("disabled", "");
        
        if($('#TOMI').val()!= null && $('#TOMI').val()!= '0'){
        	var costoCopertinaPerTomi = 1.50*$('#TOMI').val();
        	var costoCopertinaPerTomi_format = parseFloat(costoCopertinaPerTomi).toFixed(2);
        	$("#strCostoCopertinatura").text("IL PREZZO AL PUBBLICO E\' DI "+costoCopertinaPerTomi_format+" Euro");
        	$("#costoCopertinatura").val(costoCopertinaPerTomi);
        	
        }else if($('#TOMI').val()!= null && $('#TOMI').val()<= '0'){
        	var costoCopertinaPerTomi = 1.50;
        	var costoCopertinaPerTomi_format = parseFloat(costoCopertinaPerTomi).toFixed(2);
        	$("#strCostoCopertinatura").text("IL PREZZO AL PUBBLICO E\' DI "+costoCopertinaPerTomi_format+" Euro");
        	$("#costoCopertinatura").val(costoCopertinaPerTomi);
        }
        $("#recuperaInfo").hide();
	}
	
	
</script>