<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:p="http://www.springframework.org/schema/p"
	xmlns:context="http://www.springframework.org/schema/context"
	xmlns:jee="http://www.springframework.org/schema/jee" xmlns:aop="http://www.springframework.org/schema/aop"
	xmlns:tx="http://www.springframework.org/schema/tx"
	xmlns:int-jmx="http://www.springframework.org/schema/integration/jmx"
	xsi:schemaLocation="
	   http://www.springframework.org/schema/beans
	   http://www.springframework.org/schema/beans/spring-beans.xsd
	   http://www.springframework.org/schema/context
	   http://www.springframework.org/schema/context/spring-context.xsd
	   http://www.springframework.org/schema/jee
	   http://www.springframework.org/schema/jee/spring-jee.xsd
	   http://www.springframework.org/schema/aop
	   http://www.springframework.org/schema/aop/spring-aop.xsd
	   http://www.springframework.org/schema/tx
	   http://www.springframework.org/schema/tx/spring-tx.xsd
	   http://www.springframework.org/schema/integration/jmx
	   http://www.springframework.org/schema/integration/jmx/spring-integration-jmx.xsd"
	default-autowire="no">
	
	<!-- 
		Scheduler che:
		1. Cancella dal file system le immagini i cui nomi non sono presenti nelle tabelle dei prodotti vari (categorie/sottocategorie/prodotti).  
		2. Cancella le bolle di carico dei prodotti vari delle edicola precedenti a x giorni leggendo il parametro per ogni edicola.  
	 --> 
	<bean id="manutenzioneTabelleProdottiVariScheduler" class="org.springframework.scheduling.quartz.SchedulerFactoryBean">
		<property name="triggers">
			<list>
				<ref bean="manutenzioneTabelleProdottiVariCronTrigger" />
			</list>
		</property>
	</bean>
	<bean id="manutenzioneTabelleProdottiVariCronTrigger" class="org.springframework.scheduling.quartz.CronTriggerFactoryBean">
		<property name="jobDetail" ref="manutenzioneTabelleProdottiVariJobDetail" />
		<property name="cronExpression" value="0 0 2 * * ?" />
	</bean>

	<bean name="manutenzioneTabelleProdottiVariJobDetail" class="org.springframework.scheduling.quartz.JobDetailFactoryBean">
		<property name="jobClass" value="it.dpe.igeriv.job.IGerivManutenzioneTabelleProdottiVariJob" />
      	<property name="jobDataAsMap">
			<map>
				<entry key="iGerivBatchBo" value-ref="IGerivBatchService" />
				<entry key="mailingListService" value-ref="MailingListService" />
				<entry key="timeout" value="5000" />
			</map>
		</property>
	</bean>
	
	<!-- Rinomina i file delle bolle che sono andate in errore (toglie il suffisso ._ERR) per al massimo 3 volte -->
	<bean id="renameBolleInErroreCronTriggerScheduler" class="org.springframework.scheduling.quartz.SchedulerFactoryBean">
		<property name="triggers">
			<list>
				<ref bean="renameBolleInErroreCronTrigger" />
			</list>
		</property>
	</bean>
	
	<bean id="renameBolleInErroreCronTrigger" class="org.springframework.scheduling.quartz.CronTriggerFactoryBean">
		<property name="jobDetail" ref="renameBolleInErroreJobDetail" />		
		<property name="cronExpression" value="${igeriv.rename.bolle.in.errore.cron.expr}" />
	</bean>

	<bean name="renameBolleInErroreJobDetail" class="org.springframework.scheduling.quartz.JobDetailFactoryBean">
		<property name="jobClass" value="it.dpe.igeriv.job.IGerivRenameBolleInErroreJob" />
      	<property name="jobDataAsMap">
			<map>
				<entry key="agenzieService" value-ref="AgenzieService" />
				<entry key="mailingListService" value-ref="MailingListService" />
				<entry key="datiPathDir" value="${dl.path.dir.dati.in}" />
				<entry key="logPathDir" value="${igeriv.log.path}" />
				<entry key="timeout" value="5000" />
			</map>
		</property>
	</bean>
	
	
	
	
	<!-- Nuovo Job : 21/01/2016
	     Invio messaggio informativo per avvisare della generazione dell'estratto conto -->
	<bean id="avvisoPerEstrattoContoCronTriggerScheduler" class="org.springframework.scheduling.quartz.SchedulerFactoryBean">
		<property name="triggers">
			<list>
				<ref bean="avvisoPerEstrattoContoCronTrigger" />
			</list>
		</property>
	</bean>
	
	<bean id="avvisoPerEstrattoContoCronTrigger" class="org.springframework.scheduling.quartz.CronTriggerFactoryBean">
		<property name="jobDetail" ref="avvisoPerEstrattoContoJobDetail" />		
		<property name="cronExpression" value="${igeriv.avviso.estratto.conto.expr}" />
	</bean>

	<bean name="avvisoPerEstrattoContoJobDetail" class="org.springframework.scheduling.quartz.JobDetailFactoryBean">
		<property name="jobClass" value="it.dpe.igeriv.job.IGerivAvvisoPerEstrattoContoJob" />
      	<property name="jobDataAsMap">
			<map>
				<entry key="mailingListService" value-ref="MailingListService" />
				<entry key="edicoleService" value-ref="EdicoleService" />
				<entry key="logPathDir" value="${igeriv.log.path}" />
				<entry key="timeout" value="5000" />
			</map>
		</property>
	</bean>
	
	
	<!-- Nuovo Job : 21/01/2016
	     Secondo invio messaggio informativo per avvisare della generazione dell'estratto conto -->
	<bean id="avvisoPerEstrattoContoCronTriggerScheduler_2" class="org.springframework.scheduling.quartz.SchedulerFactoryBean">
		<property name="triggers">
			<list>
				<ref bean="avvisoPerEstrattoContoCronTrigger_2" />
			</list>
		</property>
	</bean>
	
	<bean id="avvisoPerEstrattoContoCronTrigger_2" class="org.springframework.scheduling.quartz.CronTriggerFactoryBean">
		<property name="jobDetail" ref="avvisoPerEstrattoContoJobDetail_2" />		
		<property name="cronExpression" value="${igeriv.avviso.estratto.conto.due.expr}" />
	</bean>

	<bean name="avvisoPerEstrattoContoJobDetail_2" class="org.springframework.scheduling.quartz.JobDetailFactoryBean">
		<property name="jobClass" value="it.dpe.igeriv.job.IGerivAvvisoPerEstrattoContoJob" />
      	<property name="jobDataAsMap">
			<map>
				<entry key="mailingListService" value-ref="MailingListService" />
				<entry key="edicoleService" value-ref="EdicoleService" />
				<entry key="logPathDir" value="${igeriv.log.path}" />
				<entry key="timeout" value="5000" />
			</map>
		</property>
	</bean>
	
	
	<!-- Nuovo Job : 02/02/2016
	     Per tutti i DL presenti nella tabella delle anagrafica DL viene eseguito la stored procedure 
	     dedita alla cancellazione delle pubblicazioni uscite prima di una certa data ( 12 mesi / 24 mesi )  -->
	<bean id="iGerivManutenzionePubblicazioniJobCronTriggerScheduler" class="org.springframework.scheduling.quartz.SchedulerFactoryBean">
		<property name="triggers">
			<list>
				<ref bean="iGerivManutenzionePubblicazioniJobCronTrigger" />
			</list>
		</property>
	</bean>
	
	<bean id="iGerivManutenzionePubblicazioniJobCronTrigger" class="org.springframework.scheduling.quartz.CronTriggerFactoryBean">
		<property name="jobDetail" ref="iGerivManutenzionePubblicazioniJob" />		
		<property name="cronExpression" value="${igeriv.manutenzione.pubblicazioni.expr}" />
	</bean>

	<bean name="iGerivManutenzionePubblicazioniJob" class="org.springframework.scheduling.quartz.JobDetailFactoryBean">
		<property name="jobClass" value="it.dpe.igeriv.job.IGerivManutenzionePubblicazioniJob" />
      	<property name="jobDataAsMap">
			<map>
				<entry key="mailingListService" value-ref="MailingListService" />
				<entry key="iGerivBatchBo" value-ref="IGerivBatchService" />
				<entry key="agenzieService" value-ref="AgenzieService" />
				<entry key="logPathDir" value="${igeriv.log.path}" />
				<entry key="timeout" value="5000" />
			</map>
		</property>
	</bean>
	
	
	
	
	
	<!-- Da usare per test -->
	<!-- 
	<bean id="JmsService" class="it.dpe.igeriv.jms.service.impl.JmsServiceImpl">
		<property name="bo">	
			<bean class="it.dpe.igeriv.bo.MockIgerivBatchBoImpl"/>
		</property>	
	</bean>
	-->
	
	<!-- Esportazione fatture e estratti conto -->
	<!--
	<bean id="fattureEstrattiContoCronTriggerScheduler" class="org.springframework.scheduling.quartz.SchedulerFactoryBean">
		<property name="triggers">
			<list>
				<ref bean="fattureEstrattiContoExportCronTrigger" />
			</list>
		</property>
	</bean>
	
	<bean id="fattureEstrattiContoExportCronTrigger" class="org.springframework.scheduling.quartz.CronTriggerBean">
		<property name="jobDetail" ref="fattureEstrattiContoExportJobDetail" />		
		<property name="cronExpression" value="0 0/1 * * * ?" />
	</bean>

	<bean name="fattureEstrattiContoExportJobDetail" class="org.springframework.scheduling.quartz.JobDetailBean">
		<property name="jobClass" value="it.dpe.igeriv.job.FattureECExporter" />
      	<property name="jobDataAsMap">
			<map>
				<entry key="dao" value-ref="BaseDao" />
				<entry key="iGerivService" value-ref="IGerivSecureService" />
				<entry key="pathEstrattiContoClienti" value="${path.estratti.conto.clienti}" />
				<entry key="pathFatture" value="${path.fatture.edicole}" />
				<entry key="timeout" value="5000" />
			</map>
		</property>
	</bean>
 	-->
</beans>