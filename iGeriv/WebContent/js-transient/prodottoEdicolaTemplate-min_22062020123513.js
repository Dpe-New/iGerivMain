var context,categoryOrderChanged=false,subCategoryOrderChanged=false,productOrderChanged=false;
window.onbeforeunload=function(){if(categoryOrderChanged){var d=[];$("#mieiProdottiTree span.level1").each(function(){d.push($(this).attr("codcategoria"))});dojo.xhrGet({url:appContext+"/pne_updateCategoryPositions.action?sortedCategoryIds="+d,handleAs:"text",headers:{"Content-Type":"application/json; charset=uft-8"},preventCache:true,sync:true})}if(subCategoryOrderChanged){var f=[];$("#mieiProdottiTree span.subFolder").each(function(){$(this).attr("changed")=="true"&&f.push($(this).attr("codcategoria")+
"_"+$(this).attr("codsubcategoria"))});dojo.xhrGet({url:appContext+"/pne_updateSubCategoryPositions.action?sortedSubcategoryIds="+f,handleAs:"text",headers:{"Content-Type":"application/json; charset=uft-8"},preventCache:true,sync:true})}if(productOrderChanged){var h=[];$("#mieiProdottiTree span.fileEdicola").each(function(){$(this).attr("changed")=="true"&&h.push($(this).attr("id").replace("folder_2_",""))});dojo.xhrGet({url:appContext+"/pne_updateProductPositions.action?sortedProdottiIds="+h,handleAs:"text",
headers:{"Content-Type":"application/json; charset=uft-8"},preventCache:true,sync:true})}};
$(document).ready(function(){conditionHasActionMessages&&jConfirm(prodErrMsg,attenzioneMsg,function(d){if(d){d=$("#codProdotto").val().trim();window.parent.document.getElementById("prodottiEdicolaFrame").contentDocument.location=appContext+"/pne_deleteProdottoEdicola.action?codProdotto="+d+"&deleteDependenciesProdotto=true"}});conditionHasActionErrors&&jAlert(actionErrors,attenzioneMsg,function(){$.alerts.dialogClass=null});$("#prodottiTree").treeview({speed:"slow",collapsed:true});docReady()});
function docReady(){prepareProdottiEdicola();prepareProdottiGenerici();$("#memorizza").click(function(){ray.ajax()});if(lastProdotto.trim()!=""&&lastProdotto!=null){showProduct(lastProdotto);prevProdotto.trim()!=""&&prevProdotto!=null&&showProduct(prevProdotto)}else if(lastSubcategory.trim()!=""&&lastSubcategory!=null){var d=$("#"+lastSubcategory).parents("li.expandable");d.children("ul").css({display:"block"});d.removeClass("expandable").removeClass("lastExpandable").addClass("collapsable").addClass("lastCollapsable");
d.children("div").first().removeClass("expandable-hitarea").addClass("collapsable-hitarea").removeClass("lastExpandable-hitarea").addClass("lastCollapsable-hitarea");d.find("ul li.expandable").find("ul").css({display:"none"});$("#mieiProdottiTree").removeAttr("style")}}
function showProduct(d){d=$("#"+d);var f=d.parents("li.expandable");f.removeClass("expandable").removeClass("lastExpandable").addClass("collapsable").addClass("lastCollapsable");f.children("div").first().removeClass("expandable-hitarea").addClass("collapsable-hitarea").removeClass("lastExpandable-hitarea").addClass("lastCollapsable-hitarea");d.closest("li.collapsable").find("ul").css({display:"block"});d.parents("ul").css({display:"block"});d.parents("li.collapsable").last().children("ul").css({display:"block"});
$("#mieiProdottiTree").removeAttr("style")}
function prepareProdottiGenerici(){var d=$("#prodottiEdicola span[id*='folderTemplate_2_'][isprodottodl='false']"),f=$("#prodottiEdicola"),h=$("#prodottiEdicola li:not(:has(span[isprodottodl=true]))"),i=$("#prodottiEdicola :not(:has(span[isprodottodl=true])) span.subFolder");d.draggable({cancel:"a.ui-icon",revert:"invalid",helper:"clone",cursor:"move",zIndex:"5000"});f.droppable({accept:"span.file",activeClass:"ui-state-highlight",drop:function(b,a){var c=Number($(a.draggable).attr("id").replace("folderTemplate_2_",
"").trim());window.parent.document.getElementById("prodottiEdicolaFrame").contentDocument.location.href=appContext+"/pne_showProdotti.action?idProdottiEdicola="+c}});i.droppable({accept:function(b){var a=b.attr("tagName")=="LI";b=b.find("span:first").hasClass("fileEdicola");return a&&b?true:false},activeClass:"ui-state-highlight",hoverClass:"ui-state-active",drop:function(b,a){categoryOrderChanged=true;var c=Number($(a.draggable).find("span:first").attr("id").replace("folder_2_","").trim()),e=$(this).attr("codcategoria").trim(),
g=$(this).attr("codsubcategoria").trim();window.parent.document.getElementById("prodottiEdicolaFrame").contentDocument.location.href=appContext+"/pne_updateProductCategory.action?codProdotto="+c+"&codCategoria="+e+"&codSottoCategoria="+g}});$("#gallery").droppable({accept:"span.fileEdicola",activeClass:"ui-state-highlight",drop:function(b,a){$(a.draggable).remove();var c=Number($(a.draggable).attr("id").replace("folder_2_","").trim());window.parent.document.getElementById("prodottiEdicolaFrame").contentDocument.location.href=
appContext+"/pne_deleteProdottoEdicola.action?codProdotto="+c}});f.sortable({delay:300,cursor:"pointer",placeholder:"ui-state-highlight",items:"> ul > li",axis:"y",revert:true,update:function(){categoryOrderChanged=true}});h.sortable({delay:300,cursor:"pointer",placeholder:"ui-state-highlight",items:"> ul > li",axis:"y",update:function(b,a){if($(a.item.context).find("span:first").attr("id").indexOf("sucategory")!=-1)subCategoryOrderChanged=true;else productOrderChanged=true;$(this).closest("li").find("span").each(function(){$(this).attr("changed",
true)})}});$("#myProducts").tooltip({delay:0,showURL:false,bodyHandler:function(){return"<b>"+msgMieiProdotti+"</b>"}});$(".linethrough").tooltip({delay:0,showURL:false,bodyHandler:function(){return"<b>"+msgProdottoEsclusoVendite+"</b>"}});$("#availableProducts, #selectedProdcuts").tooltip({delay:0,showURL:false,bodyHandler:function(){return"<b>"+msgProdottiDisponibili+"</b>"}})}
function prepareProdottiEdicola(){function d(b,a){var c=a.attr("id").replace("folder_2_","");if(b=="delete")jConfirm(msgCancellareProdotto,attenzioneMsg,function(e){if(e){ray.ajax();window.parent.document.getElementById("prodottiEdicolaFrame").contentDocument.location.href=appContext+"/pne_deleteProdottoEdicola.action?codProdotto="+c}});else b=="edit"&&openDiv("popup_name",800,570,appContext+"/pne_editProdottoEdicola.action?codProdotto="+c,"","",window.parent.document)}function f(b,a){var c=a.attr("codcategoria").trim(),
e=a.attr("codsubcategoria").trim(),g="";if(b=="insertScat")g=appContext+"/pne_editSottoCategoria.action?codCategoria="+c;else if(b=="editScat")g=appContext+"/pne_editSottoCategoria.action?codCategoria="+c+"&codSottoCategoria="+e;else b=="deleteScat"&&jConfirm(msgCancellareSottocategoria.replace("{0}",a.text()),attenzioneMsg,function(j){if(j){ray.ajax();window.parent.document.getElementById("prodottiEdicolaFrame").contentDocument.location.href=appContext+"/pne_deleteSottoCategoria.action?codCategoria="+
c+"&codSottoCategoria="+e}});g!=""&&openDiv("popup_name",600,350,g,"","",window.parent.document)}function h(b,a){var c=a.attr("codcategoria").trim(),e="";if(b=="insertCat")e=appContext+"/pne_editCategoria.action";else if(b=="insertScat")e=appContext+"/pne_editSottoCategoria.action?codCategoria="+c;else if(b=="editCat")e=appContext+"/pne_editCategoria.action?codCategoria="+c;else b=="deleteCat"&&jConfirm(msgCancellareCategoria.replace("{0}",a.text()),attenzioneMsg,function(g){if(g){ray.ajax();window.parent.document.getElementById("prodottiEdicolaFrame").contentDocument.location.href=
appContext+"/pne_deleteCategoria.action?codCategoria="+c}});e!=""&&openDiv("popup_name",600,350,e,"","",window.parent.document)}$("#mieiProdottiTree").treeview({speed:"slow",collapsed:true});$("span[id*='folderTemplate_']").click(function(){$(this).effect("highlight",{},1E3)});$("#prodottiEdicola span.fileEdicola[isprodottodl=false]").contextMenu({menu:"myMenu",yTop:-10,xLeft:0,highlight:true},function(b,a,c){d(b,a,c)});$("#prodottiEdicola span.fileEdicola[isprodottodl=true]").contextMenu({menu:"menuProdottiDl",
yTop:-10,xLeft:0,highlight:true},function(b,a,c){d(b,a,c)});var i=$("#prodottiEdicola li.level1:not(:has(span[isprodottodl=true])) span.level1");i.contextMenu({menu:"categoryEditDelete",yTop:-10,xLeft:0,highlight:true},function(b,a,c){h(b,a,c)});$("#prodottiEdicola li.level2:not(:has(span[isprodottodl=true])) span.subFolder").filter(":not(:has(span[isprodottodl='true']))").contextMenu({menu:"subcategoryEditDelete",yTop:-10,xLeft:0,highlight:true},function(b,a,c){if(b=="insertProd"){b=a.parent().parent().parent().find("span").first().text().trim();
a=a.text().trim();a=appContext+"/pne_editProdottoEdicola.action?catTitle="+escape(b)+"&subCatTitle="+escape(a);openDiv("popup_name",800,570,a,"","",window.parent.document)}else f(b,a,c)});if(isProdottiEdicolaEmpty)$("#prodottiEdicola").contextMenu({menu:"categoryInsert",yTop:-10,xLeft:0,highlight:true},function(){openDiv("popup_name",600,350,appContext+"/pne_editCategoria.action","","",window.parent.document)});else i.length==0&&$("#prodottiEdicola li.level1:has(span[isprodottodl=true]) span.level1").contextMenu({menu:"categoryInsert",
yTop:-10,xLeft:0,highlight:true},function(){openDiv("popup_name",600,350,appContext+"/pne_editCategoria.action","","",window.parent.document)})};