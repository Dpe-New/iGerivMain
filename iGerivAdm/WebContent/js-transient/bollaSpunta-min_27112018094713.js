$(document).ready(function(){if(conditionItensBolla){setContentDivHeight(135);var a=$("#messageDiv");if(conditionDisableForm){disableAllFormFields("dataTipoBolla");var c=document.createElement("div");c.style.color="red";c.style.width="180px";c.style.borderStyle="solid";c.style.border="1px solid red";c.style.textAlign="center";c.innerHTML="<b>"+msgBollaGiaInviata;a.css({width:"180px"});if(a.find("div")[0]){y=a.find("div")[0];a.replace(c,y)}else a.append(c)}else{a.css({border:"none"});a.text("")}$.alt("X",
function(){setModalita(MODALITA_RICERCA)});$("#barcode").length>0&&$("#barcode").keydown(manageBarcodeSpuntaKeyDown);$("#imgClients, #findPub").tooltip({delay:0,showURL:false});a=document.getElementById("BollaControlloTab_table");c=0;for(var b;b=a.rows[c];c++)for(var d=null,f=null,i=0,g;g=b.cells[i];i++)switch(g.cellIndex){case 1:f=$(g).text();break;case 2:d=$(g).text();$(g).css({cursor:"pointer"});$(g).click(function(){var h=$(this).parent(),l=h.attr("idtn");h=h.find("td:nth-child(10)").find("input:hidden[name='pk']").first().val();
addResultRow(l,h,true);$("#qta").val(1)});break;case 6:$(g).click(function(){var h=$(this).find("a");if(h.length>0&&h.attr("href").length>0){var l=$(this).closest("tr").find("td:nth-child(2)").first().text();openStatistica(h.attr("href"),l)}});$(g).tooltip({delay:0,showURL:false,bodyHandler:function(){return"<b>"+msgVisualizzaStatistiche+"</b>"}});break;case 9:$(g).find("input:text").first().change(function(){setDifferenze($(this))});break;case 10:var j=$(b).attr("iv"),m=$(b).attr("pv"),k=$(b).attr("idtn"),
o=$(b).attr("resp"),p=$(b).attr("fb");if(k&&k!="undefined"||j&&j>0||m&&m!=" "||o&&o!="undefined"){var n='<span style="float:left; white-space:nowrap; overflow:hidden">';if((typeof p=="undefined"||p!="true")&&k&&k!="undefined"){var q=$("#noteRivenditaCpu"+f).length>0&&$("#noteRivenditaCpu"+f).val().trim().length>0;q="note_rivendita"+($("#noteRivendita"+k).val().trim().length>0||q?"_red":"")+".gif";var r=getNoteRivendita($("#noteRivendita"+k).val(),$("#noteRivenditaCpu"+f).val());n+='<img name="noteRiv" id="noteRiv'+
k+'" src="/app_img/'+q+'" border="0px" style="cursor:pointer; border-style: none" onclick="javascript: addNote(\''+d.replace(RegExp("'","g"),"\\'")+"','"+k+"','"+f+'\')" title="'+r+'" alt="'+msgNoteRivendita+'" />&nbsp;'}if(j&&j>0||m&&m!=" "||o=="true"){if(j&&j==1)n+='<img src="/app_img/non_valorizzare.jpg" border="0px" style="border-style: none" title="'+msgNonValorizzare+'" alt="'+msgNonValorizzare+'" />&nbsp;';else if(j&&j==2){j=typeof $(b).attr("dpa")!="undefined"&&$(b).attr("dpa").length>0?"&nbsp;<span style='font-size:80%'>("+
msgDataPresuntoAddebito+": "+$(b).attr("dpa")+")</span>":"";n+='<img src="/app_img/conto_deposito.gif" border="0px" style="border-style: none" title="'+msgContoDeposito+j+'" alt="'+msgContoDeposito+j+'" />&nbsp;'}if(m&&m!=" ")n+='<img src="/app_img/cambio_prezzo.jpg" border="0px" style="border-style: none" title="'+msgPrezzoVariato+'" alt="'+msgPrezzoVariato+'" />&nbsp;';if(o=="true")n+='<img src="/app_img/respingere.png" border="0px" style="border-style: none" title="'+msgDaRespingereInResa+'" alt="'+
msgDaRespingereInResa+'" />'}if(typeof p!="undefined"&&p=="true")n+=$(g).text();n+="</span>";$(g).html(n)}$(g).find("img").tooltip({delay:0,showURL:false});break;case 11:$(g).click(function(){var h=$(this).find("a");h.length>0&&h.attr("href").length>0&&openOrdini(h.attr("href"))});break;case 12:break;default:$(g).css({cursor:"pointer"});$(g).click(function(){var h=$(this).parent(),l=h.attr("idtn");h=h.find("td:nth-child(10)").find("input:hidden[name='pk']").first().val();addResultRow(l,h,true);$("#qta").val(1)})}addFadeLayerEvents();
setLastFocusedElement();$(this).bind("keydown",bollaRivKeyPress)}setDataTipoBolla(dataTipoBolla,"dataTipoBolla");$("#dataTipoBolla").click(function(){var h=$(this).val();$(this).data("oldData",h)}).change(function(){var h=$(this).data("oldData"),l=$(this).val().split("|")[3];if(typeof l!=="undefined"&&l!=""&&l=="true"){$.alerts.dialogClass="style_1";jAlert(msgBollaNonModificabile,attenzioneMsg.toUpperCase(),function(){$.alerts.dialogClass=null;$("#filterForm").submit()})}else if(typeof h!=="undefined"&&
h!=""){$.alerts.dialogClass="style_1";PlaySound("beep3");jConfirm(msgCambioBolla,attenzioneMsg,function(s){$.alerts.dialogClass=null;s?$("#filterForm").submit():$("#dataTipoBolla").val(h)})}else $("#filterForm").submit()});$("#barcode").focus()});
function setDifferenze(a){var c=a.parent(),b=a.val()==""?0:a.val();a=c.prev("td").prev("td");var d=c.prev("td");c=d.prev("td").prev("td").text().trim()==""?0:Number(d.prev("td").prev("td").text().trim());d.text(b);b=d.text().trim()==""?0:Number(d.text().trim());a.text(Number(c)+Number(b));return true}
function openStatistica(a,c){var b=a.split("?")[1].split("&"),d=b[0].split("=")[1];b=b[1].split("=")[1];openDiv("popup_name",900,380,appContext+"/statisticaPubblicazioni_showNumeriPubblicazioniStatistica.action?codPubblicazione="+c+"&idtn="+d+"&periodicita="+b);return false}
function bollaRivKeyPress(a){var c=a.keyCode?a.keyCode:a.charCode;if(!a.shiftKey&&c=="9"||c=="40")setTimeout(function(){var b=lastFocusedFieldId.replace(/([|])/g,"\\$1"),d=$("#"+b);setDifferenze(d);d=d.closest("tr").next().find("input:text[name='differenze']").first();$("#"+b).css("background","#fff");d.focus();d.select()},100);else if(a.shiftKey&&c=="9"||c=="38")setTimeout(function(){var b=lastFocusedFieldId.replace(/([|])/g,"\\$1"),d=$("#"+b);setDifferenze(d);d=d.closest("tr").prev().find("input:text[name='differenze']").first();
$("#"+b).css("background","#fff");d.focus();d.select()},100);else if(c==37){a.preventDefault();$("#qta").select();$("#qta").focus();$("#barcode").css("background","#fff")}else if(c==39){a.preventDefault();$("#barcode").select();$("#barcode").focus();$("#qta").css("background","#fff")}else if(c==107||c==171||c==187){a.preventDefault();a=isNaN($("#qta").val())?0:Number($("#qta").val());$("#qta").val(++a)}else if((c==109||c==173||c==189)&&lastFocusedFieldId.indexOf("differenze")==-1){a.preventDefault();
a=isNaN($("#qta").val())?0:Number($("#qta").val());$("#qta").val(--a)}}function openOrdini(a){a=a.split("?")[1].split("&")[0].split("=")[1];openDiv("popup_name",900,380,appContext+"/bollaRivenditaSpunta_showOrdini.action?idtn="+a);return false}function nessunaPubblicazioneAction(){$("#barcode").val("");return false}
function noBarcodeFoundAction(){$.alerts.dialogClass="style_1";jAlert(nessunaPubblicazione,attenzioneMsg.toUpperCase(),function(){$.alerts.dialogClass=null;nessunaPubblicazioneAction()});return false}
function esportaOrdini(){var a=0,c=[];$("#totalHeader_1").text($("#BollaControlloTab_table tbody tr td:nth-child(16)").each(function(){var b=$(this),d=$(this).prev().prev().find("input:text[name^='differenzeFondoBolla'"),f=b.text().trim();if(f&&f.length>0&&d.length==0){b=b.find("a");if(b.length>0&&b.attr("href").length>0){b=b.attr("href").split("?")[1].split("&")[0].split("=")[1];c[a++]=b}}}));if(c.length>0){$("#ReportOrdiniClientiForm").empty();$("#ReportOrdiniClientiForm").append('<input type="hidden" name="dataTipoBolla" value="'+
$("#dataTipoBolla").val()+'"/>');$("#ReportOrdiniClientiForm").append('<input type="hidden" name="idtnOrdini" value="'+c+'"/>');$("#ReportOrdiniClientiForm").attr("target","_blank");$("#ReportOrdiniClientiForm").submit();unBlockUI()}}
function reloadDataTipoBolle(){dojo.xhrGet({url:"${pageContext.request.contextPath}/pubblicazioniRpc_getDateTipoBolla.action",handleAs:"json",headers:{"Content-Type":"application/json; charset=uft-8"},preventCache:true,handle:function(a){a=JSON.parse(a);for(var c="",b=0;b<a.length;b++){var d="",f=a[b].dataBollaFormat+"|"+a[b].tipoBolla+"|"+a[b].readonly+"|";if(dataTipoBolla==f)d="selected";c+=Number(a[b].bollaTrasmessaDl)>=2?"<option "+d+' style="color:red" value="'+f+'">'+a[b].dataBollaFormat+"&nbsp;&nbsp;"+
a[b].tipoBolla+"&nbsp;("+msgBollaTrasmessa+")</option>":Number(a[b].bollaTrasmessaDl)==1?"<option "+d+' style="color:blue" value="'+f+'">'+a[b].dataBollaFormat+"&nbsp;&nbsp;"+a[b].tipoBolla+"&nbsp;("+msgBollaInTrasmissione+")</option>":Number(a[b].bollaTrasmessaDl)==0?"<option "+d+' value="'+f+'">'+a[b].dataBollaFormat+"&nbsp;&nbsp;"+a[b].tipoBolla+"&nbsp;("+msgBollaNonTrasmessa+")</option>":"<option "+d+' value="'+f+'">'+a[b].dataBollaFormat+"&nbsp;&nbsp;"+a[b].tipoBolla+"</option>"}$("#dataTipoBolla").empty();
$("#dataTipoBolla").html(c)}})}function manageBarcodeSpuntaKeyDown(a){var c=a.keyCode?a.keyCode:a.charCode;if(c=="13"){c=a.target?a.target:a.srcElement?a.srcElement:null;a.preventDefault();a=c.value;c=/(?:^[\d]{1,4}){1}(?:[\\.][\d]{1,2})?$/;var b=/^[%a-zA-Z]{1}.*$/;a=a.replace(/([,])/g,".");if(/(?:^\d{5,9}$)|(?:^\d{11,18}$)/.test(a))manageBarcodeSearch(a);else if(c.test(a))managePriceSearch(a);else b.test(a)&&manageTitleSearch(a)}else c=="27"&&setModalita(MODALITA_DEFAULT)}
function manageBarcodeSearch(a){if($("#"+a).length==0)setTimeout(function(){$.alerts.dialogClass="style_1";jAlert(pubNonInBollaMsg,attenzioneMsg.toUpperCase(),function(){$.alerts.dialogClass=null;$("#barcode").val("");$("#barcode").focus()})},100);else{a=$("#"+a).val();if(a.length>0){var c=$("#idtn_"+$("#barcode").val()).val();addSpunta(c,a)}}}
function managePriceSearch(a){var c=parseLocalNum(a),b="[";$("#BollaControlloTab_table tbody tr td:nth-child(6)").each(function(){var d=parseLocalNum($(this).text().trim());if(Number(d)==Number(c)){var f=$(this).parent();d=f.attr("idtn");var i=f.find("td:nth-child(3)").text(),g=f.find("td:nth-child(6)").text();f=f.find("td:nth-child(10)").find("input[name='pk']").first().val();b+='{"label":"'+i+" ("+g+')","value":"'+i+'","idtn":"'+d+'","pk":"'+f+'"},'}});if(b.endsWith(","))b=b.substring(0,b.length-
1);b+="]";$("input#barcode").autocomplete({source:jQuery.parseJSON(b),preventCache:true,select:function(d,f){addSpunta(f.item.idtn,f.item.pk)}});e=jQuery.Event("keydown");e.which=13;$("#barcode").trigger(e)}
function manageTitleSearch(a){var c="[";$("#BollaControlloTab_table tbody tr td:nth-child(3)").each(function(){var b=$(this).text();if(b.toUpperCase().startsWith(a.toUpperCase())){var d=$(this).parent(),f=d.attr("idtn");d=d.find("td:nth-child(10)").find("input[name='pk']").first().val();c+='{"label":"'+b+'","value":"'+b+'","idtn":"'+f+'","pk":"'+d+'"},'}});if(c.endsWith(","))c=c.substring(0,c.length-1);c+="]";$("input#barcode").autocomplete({source:jQuery.parseJSON(c),select:function(b,d){addSpunta(d.item.idtn,
d.item.pk)}});e=jQuery.Event("keydown");e.which=13;$("#barcode").trigger(e)}function addSpunta(a,c){addResultRow(a,c,false);setTimeout(function(){$("#qta").val(1);$("#barcode").val("");setModalita(MODALITA_DEFAULT)},100)}
function addResultRow(a,c,b){b=modalita==MODALITA_RICERCA?true:b;var d=$("#BollaControlloTab_table tbody tr[idtn='"+a+"']").first(),f=d.find("td:nth-child(2)").text(),i=d.find("td:nth-child(3)").text(),g=d.find("td:nth-child(4)").text(),j=d.find("td:nth-child(5)").text(),m=d.find("td:nth-child(6)").text();a=isNaN(d.find("td:nth-child(7)").text())?0:d.find("td:nth-child(7)").text();d=isNaN(d.find("td:nth-child(8)").text())?0:d.find("td:nth-child(8)").text();var k=$("#qta").val();d=Number(d)+Number(k);
k='<table cellspacing="0" cellpadding="0" border="0" width="100%" style="table-layout: fixed;" class="extremeTableFieldsVeryLarge" id="BollaControlloTab_table_head"><thead><tr><td width="8%" class="tableHeader" style="text-align:center">'+msgCpu+'</td><td width="30%" class="tableHeader" style="cursor: default;">'+msgTitolo+'</td><td width="22%" class="tableHeader">'+msgSottotitolo+'</td><td width="8%" class="tableHeader" style="text-align:center">'+msgNumero+'</td><td width="8%" class="tableHeader" style="text-align:right">'+
msgPrezzoLordo+'</td><td width="8%" class="tableHeader" style="text-align:center">'+msgCopieBolla+'</td><td width="8%" class="tableHeader" style="text-align:center">'+msgCopieLette+'</td><td width="8%" class="tableHeader" style="text-align:center">'+msgDifferenze+"</td></tr></thead>";k+='<tbody><tr><td width="8%" style="text-align: center;">'+f+'</td><td width="30%">'+i+'</td><td width="22%">'+g+'</td><td width="8%" style="text-align: center;">'+j+'</td><td width="8%" style="text-align: right;">'+
m+'</td><td width="8%" style="text-align:center">'+a+'</td><td width="8%" style="text-align:center">'+d+'</td><td width="8%" style="text-align:center">'+(Number(d)-Number(a))+"</td></tr></tbody></table>";$("#spuntaOutput").html(k);f=c.replace(/([|])/g,"\\$1");f=$("#differenze"+f).parent().prev("td");i=f.prev("td");if(!b){i.text(d);f.text(d-a)}if(typeof $lastTr!="undefined"){$lastTr.contents("td").css({"border-top":"none","border-bottom":"none","border-left":"none","border-right":"none"});$lastTr.contents("td:first").css("border-left",
"none");$lastTr.contents("td:last").css("border-right","none")}b=i.parent();b.contents("td").css({"border-top":"1px solid red","border-bottom":"1px solid red","border-left":"none","border-right":"none"});b.contents("td:first").css("border-left","1px solid red");b.contents("td:last").css("border-right","1px solid red");document.getElementById("differenze"+c).scrollIntoView(false);$lastTr=b}
function validateFields(){for(var a=document.getElementById("BollaControlloTab_table"),c=[],b=0,d;d=a.rows[b];b++)if(b>0)for(var f=0,i;i=d.cells[f];f++){var g=i.cellIndex;if(g==7)c.push($(i).text());else if(g==8){g=$(i);i=g.text().trim();var j=g.next("td").find("input:text").first();g=j.val();if(i!=""&&g==""){$.alerts.dialogClass="style_1";jAlert(msgDifferenzeNonConfermate,attenzioneMsg.toUpperCase(),function(){$.alerts.dialogClass=null;j.focus()});unBlockUI();return false}else if(g!=""&&isNaN(g)){$.alerts.dialogClass=
"style_1";jAlert(msgCampoNumerico.replace("{0}",msgConfermaDifferenze),attenzioneMsg.toUpperCase(),function(){$.alerts.dialogClass=null;j.focus()});unBlockUI();return false}}}$("#spunte").val(c);return true}
function copiaDifferenze(){jConfirm(msgConfirmCopiaDifferenze,attenzioneMsg,function(a){$.alerts.dialogClass=null;a&&$("#BollaControlloTab_table tbody tr td:nth-child(9)").each(function(){var c=$(this),b=c.prev("td"),d=b.prev("td").text().trim()==""?0:b.prev("td").text().trim(),f=c.text().trim();if(f!=""){c.next("td").find("input:text").first().val(f);b.text(Number(d)+Number(f))}})})}
function setModalita(a){modalita=a;switch(a){case MODALITA_RICERCA:$("#qta").attr("disabled",true);$("#barcode").css({"border-style":"solid","border-width":"3px","border-color":"#25C23F"});$("#spuntaOutput").is(":visible")&&$("#spuntaOutput").css({"margin-top":"14px"});break;default:$("#qta").val(1);$("#qta").attr("disabled",false);$("#barcode").css({"border-style":"none"});$("#spuntaOutput").is(":visible")&&$("#spuntaOutput").css({"margin-top":"18px"})}$("#barcode").focus()};