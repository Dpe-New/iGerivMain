setDataTipoBolla(dataTipoBolla,"dataTipoBolla");
if(conditionItensBolla){$(document).ready(function(){$("#footer").hide();var a=$("#messageDiv");if(conditionDisableForm)disableBollaConsegna();else{a.css({border:"none"});a.text("")}$("#totalHeader_1").text($("#BollaControlloTab_table tr.calcRow td:nth-child(11)").text());$("#totalHeader_2").text($("#importoLordo").val());$("#totalHeader_3").text(totaleBollaFormat);$("#totalHeader_4").text(totaleFondoBollaFormat);$("#totalHeader_5").text(totaleBollaLordoFormat);$("#totalHeader_6").text(totaleFondoBollaLordoFormat);
$("#imgClients, #imgClientsDetail").tooltip({delay:0,showURL:false});a=document.getElementById("BollaControlloTab_table");for(var c=0,b;b=a.rows[c];c++)if(c>0)for(var d=null,e=null,q=0,g;g=b.cells[q];q++)switch(g.cellIndex){case 1:e=$(g).text();break;case 2:d=$(g).text();$(g).click(function(){openLayer($(this))});break;case 9:$(g).click(function(){var k=$(this).find("a");if(k.length>0&&k.attr("href").length>0){var x=$(this).closest("tr").find("td:nth-child(2)").first().text();openStatistica(k.attr("href"),
x)}});$(g).tooltip({delay:0,showURL:false,bodyHandler:function(){return"<b>"+msgVisualizzaStatistiche+"</b>"}});break;case 11:case 12:break;case 13:var i=$(b).attr("iv"),f=$(b).attr("pv"),l=$(b).attr("idtn"),m=$(b).attr("resp"),j=$(b).attr("fb"),h=$(b).attr("qfdv"),r=typeof h!="undefined"&&h!="",n=$(b).attr("cddif"),s=typeof n!="undefined"&&n!="",o=$(b).attr("scdif"),t=typeof o!="undefined"&&o!="";if(l&&l!="undefined"||i&&i>0||f&&f!=" "||m&&m!="undefined"){h='<span style="float:left; white-space:nowrap; overflow:hidden">';
if((typeof j=="undefined"||j!="true")&&l&&l!="undefined"){j=$("#noteRivenditaCpu"+e).val();var p=typeof j!="undefined"?j.trim().length>0:false,u=$("#noteRivendita"+l).val();p="note_rivendita"+(u.trim().length>0||p?"_red":"")+".gif";j=getNoteRivendita(u,j);h+='&nbsp;<img name="noteRiv" id="noteRiv'+l+'" src="/app_img/'+p+'" border="0px" style="border-style: none" onclick="javascript: addNote(\''+d.replace(RegExp("'","g"),"\\'")+"','"+l+"','"+e+'\')" title="'+j+'" alt="'+msgNoteRivendita+'" />'}if(i&&
i>0||f&&f!=" "||m=="true"){if(i&&i==1)h+='<img src="/app_img/non_valorizzare.jpg" border="0px" style="border-style: none" title="'+msgNonValorizzare+'" alt="'+msgNonValorizzare+'" />';else if(i&&i==2){i=typeof $(b).attr("dpa")!="undefined"&&$(b).attr("dpa").length>0?"&nbsp;<span style='font-size:80%'>("+msgDataPresuntoAddebito+": "+$(b).attr("dpa")+")</span>":"";h+='&nbsp;<img src="/app_img/conto_deposito.gif" border="0px" style="border-style: none" title="'+msgContoDeposito+i+'" alt="'+msgContoDeposito+
i+'" />'}if(f&&f!=" ")h+='&nbsp;<img src="/app_img/cambio_prezzo.jpg" border="0px" style="border-style: none" title="'+msgPrezzoVariato+'" alt="'+msgPrezzoVariato+'" />';if(m=="true")h+='&nbsp;<img src="/app_img/respingere.png" border="0px" style="border-style: none" title="'+msgDaRespingereInResa+'" alt="'+msgDaRespingereInResa+'" />'}if(r||s||t){f="";if(s)f=n.split("|")[0].toString()=="true"?msgPubblicazioneCDInBollaNonInforete.replace("{0}",d):msgPubblicazioneCDInforeteNonInBolla.replace("{0}",
d);else if(t){f=o.split("|");f=msgScontoDiversoInforete.replace("{0}",d).replace("{1}",f[0]).replace("{2}",f[1])}else if(r)f=msgFatturatoInContoDepositoDiversoDaVenduto;h+=$(g).text()+'&nbsp;<img src="/app_img/important_small.png" name="attImg" width="17px" height="17px" border="0px" style="border-style: none" title="'+f+'" alt="'+f+'" />'}else h+=$(g).text();h+="</span>";$(g).html(h)}$(g).find("img").tooltip({delay:0,showURL:false});break;case 14:$(g).click(function(){var k=$(this).find("a");k.length>
0&&k.attr("href").length>0&&openOrdini(k.attr("href"))});break;case 15:break;default:$(g).click(function(){openLayer($(this))})}addFadeLayerEvents();setLastFocusedElement();$(this).bind("keydown",bollaRivKeyPress);$("#barcode").length>0&&$("#barcode").keydown(manageBarcodeKeyDown);var v=$("#BollaControlloTab_table img[name='attImg']");if(v.length>0){var w=function(){v.animate({opacity:0.2},500,"linear").animate({opacity:1},500,"linear",w)};w()}$("#barcode").focus()});var disableBollaConsegna=function(){disableAllFormFields("dataTipoBolla",
"soloRigheSpuntare","submitFilter","barcode","popup_ok");var a=document.createElement("div");a.style.color="red";a.style.width="180px";a.style.borderStyle="solid";a.style.border="1px solid red";a.style.textAlign="center";a.innerHTML="<b>"+msgBollaGiaInviata;var c=$("#messageDiv");c.css({width:"180px"});if(c.find("div")[0]){y=c.find("div")[0];c.replace(a,y)}else c.append(a)},bollaRivKeyPress=function(a){var c=a.keyCode?a.keyCode:a.charCode;if(!a.shiftKey&&c=="9"||c=="40")setTimeout(function(){var b=
lastFocusedFieldId.replace(/([|])/g,"\\$1"),d=$("#"+b).closest("tr").next().find("input:text[name^='fieldMap']").first();$("#"+b).css("background","#fff");d.focus();$("#"+b).trigger("blur")},100);else if(a.shiftKey&&c=="9"||c=="38")setTimeout(function(){var b=lastFocusedFieldId.replace(/([|])/g,"\\$1"),d=$("#"+b).closest("tr").prev().find("input:text[name^='fieldMap']").first();$("#"+b).css("background","#fff");d.focus();$("#"+b).trigger("blur")},100)};window.onbeforeunload=function(){if(attivaMemorizzazioneAutomatica&&
$("#BollaControlloForm input:hidden[name^=modificato][value=true]").length>0){validateFields("BollaControlloForm");validateFields(false)&&setFieldsToSave(true)&&setFormAction("BollaControlloForm","bollaRivendita_save.action","","messageDiv",true,"",function(){setFieldsToSave(false)},"",false);return msgConfirmSaveBolla}};var openLayer=function(a){var c=a.parent(),b=c.attr("divParam").split("?")[1].split("&"),d=b[0].split("=")[1],e=a="";if(b.length>1){a=b[1].split("=")[1];e=b[2].split("=")[1]}c=c.find("td:nth-child(13)").find("input:text[name^='field']:first").attr("id").replace("differenze",
"");d=appContext+"/sonoInoltreUscite_showRichiesteRifornimenti.action?idtn="+d+"&pkSel="+c+"&coddl="+e;if(a!="")d+="&periodicita="+a;lastFocusedRow!=""&&lastFocusColor!=""&&lastFocusedRow.css({backgroundColor:lastFocusColor});openDiv("popup_name",900,500,d);return false},openOrdini=function(a){a=a.split("?")[1].split("&")[0].split("=")[1];openDiv("popup_name",900,380,appContext+"/bollaRivendita_showOrdini.action?idtn="+a);return false},openStatistica=function(a,c){var b=a.split("?")[1].split("&"),
d=b[0].split("=")[1];b=b[1].split("=")[1];openDiv("popup_name",900,380,appContext+"/statisticaPubblicazioni_showNumeriPubblicazioniStatistica.action?codPubblicazione="+c+"&idtn="+d+"&periodicita="+b);return false},$fields=$("#BollaControlloForm input:text[name^=field]");$fields.numeric(false,null,function(){var a=$(this),c=a.next("input:hidden[name^=spunta]").next("input:hidden[name^=modificato]");if(Math.abs(a.val())>101){PlaySound("beep3");jConfirm(differenzaMoltoGrandeConfirm.replace("{0}",a.val()),
attenzioneMsg.toUpperCase(),function(b){if(b)c.val("true");else{setTimeout(function(){a.focus()},50);a.val("");return false}},true,false);return false}c.val("true")});$("#BollaControlloForm input:checkbox[name^=spunte]").change(function(){checkboxChanged($(this))});var checkboxChanged=function(a){var c=a.attr("checked");a=a.parent("td").next("td").find("input:hidden[name^=spunta]").first();var b=a.next("input:hidden[name^=modificato]");a.val(c?1:0);b.val("true")},setAllCheckboxChanged=function(){$("#BollaControlloForm input:checkbox[id^=dpeChkbx_]").each(function(){var a=
$(this).parent("td").next("td").find("input:hidden[name^=spunta]").first(),c=a.next("input:hidden[name^=modificato]");a.val(1);c.val("true")});return false},setFieldsToSave=function(a){$("#BollaControlloForm input:text[name^=field]").each(function(){var c=$(this),b=c.next("input:hidden[name^=spunta]");if(a){c.data("oldVal",c.val());b.data("oldVal",b.val())}else{var d=b.next("input:hidden[name^=modificato]");c.data("oldVal")!=c.val()||b.data("oldVal")!=b.val()?d.val("true"):d.val("false")}});return true},
nessunaPubblicazioneAction=function(){$("#barcode").val("");return false},noBarcodeFoundAction=function(){$.alerts.dialogClass="style_1";jAlert(nessunaPubblicazione,attenzioneMsg.toUpperCase(),function(){$.alerts.dialogClass=null;nessunaPubblicazioneAction()});return false},esportaOrdini=function(a){var c=$("#dataTipoBolla").val().split("|")[0];jConfirm(confirmEsportareClientiDiTutteLeBolle.replace("{0}",c),attenzioneMsg.toUpperCase(),function(b){try{if(b){a!=2&&fillFormEsportaOrdini();$("#ReportOrdiniClientiForm").append('<input type="hidden" name="esportaClientiDiTutteLeBolle" value="true"/>')}else if(fillFormEsportaOrdini()<=
0)throw"NoOrdersException";$("#ReportOrdiniClientiForm").append('<input type="hidden" name="tipoReportOrdiniClienti" value="'+a+'"/>');$("#ReportOrdiniClientiForm").append('<input type="hidden" name="dataTipoBolla" value="'+$("#dataTipoBolla").val()+'"/>');$("#ReportOrdiniClientiForm").submit()}catch(d){if(d=="NoOrdersException"){$.alerts.dialogClass="style_1";jAlert(msgNessunOrdineClienteInBolla,attenzioneMsg.toUpperCase(),function(){$.alerts.dialogClass=null});return false}}unBlockUI()},true,true)},
fillFormEsportaOrdini=function(){var a=0,c=[];$("#totalHeader_1").text($("#BollaControlloTab_table tbody tr td:nth-child(15)").each(function(){var b=$(this),d=$(this).prev().prev().find("input:text[name^='fieldFBMap'"),e=b.text().trim();if(e&&e.length>0&&d.length==0){b=b.find("a");if(b.length>0&&b.attr("href").length>0){b=b.attr("href").split("?")[1].split("&")[0].split("=")[1];c[a++]=b}}}));if(c.length>0){$("#ReportOrdiniClientiForm").empty();$("#ReportOrdiniClientiForm").append('<input type="hidden" name="idtnOrdini" value="'+
c+'"/>');$("#ReportOrdiniClientiForm").attr("target","_blank")}return c.length},reloadDataTipoBolle=function(){dojo.xhrGet({url:appContext+"/pubblicazioniRpc_getDateTipoBolla.action",handleAs:"json",headers:{"Content-Type":"application/json; charset=uft-8"},preventCache:true,handle:function(a){a=JSON.parse(a);for(var c="",b=0;b<a.length;b++){var d="",e=a[b].dataBollaFormat+"|"+a[b].tipoBolla+"|"+a[b].readonly+"|";if(dataTipoBolla==e){d="selected";a[b].readonly==true&&disableBollaConsegna()}c+=Number(a[b].bollaTrasmessaDl)>=
2?"<option "+d+' style="color:red" value="'+e+'">'+a[b].dataBollaFormat+"&nbsp;&nbsp;"+a[b].tipoBolla+"&nbsp;("+msgBollaTrasmessa+")</option>":Number(a[b].bollaTrasmessaDl)==1?"<option "+d+' style="color:blue" value="'+e+'">'+a[b].dataBollaFormat+"&nbsp;&nbsp;"+a[b].tipoBolla+"&nbsp;("+msgBollaInTrasmissione+")</option>":Number(a[b].bollaTrasmessaDl)==0?"<option "+d+' value="'+e+'">'+a[b].dataBollaFormat+"&nbsp;&nbsp;"+a[b].tipoBolla+"&nbsp;("+msgBollaNonTrasmessa+")</option>":"<option "+d+' value="'+
e+'">'+a[b].dataBollaFormat+"&nbsp;&nbsp;"+a[b].tipoBolla+"</option>"}$("#dataTipoBolla").empty();$("#dataTipoBolla").html(c)}})}};