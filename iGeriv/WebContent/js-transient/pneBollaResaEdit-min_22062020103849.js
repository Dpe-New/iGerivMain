var stopWaitingDivBollaResa=false,allowSearch=false;
$(document).ready(function(){$.datepicker.setDefaults($.datepicker.regional.it);$("#dataDocumentoEdit").datepicker();isNew&&$("#dataDocumentoEdit").val(dataDocumento);$("#deleteRow, #addRow, #imgPrint").tooltip({delay:0,showURL:false});$("#meBollaResa").click(function(){stopWaitingDivBollaResa||ray.ajax()});$("#meInvBollaResa").click(function(){memInvBollaResaPressed=true;stopWaitingDivBollaResa||ray.ajax()});addFadeLayerEvents();setLastFocusedElement();setTableFields();$("#dataDocumentoEdit").blur(function(){setTimeout(function(){$("#dataDocumentoEdit").val().trim().length>
0&&$("#dataDocumentoEdit").trim().val()!=$("#dataDocumentoOld").val()&&dojo.xhrGet({url:appContext+"/pneResaJ_isDataDocumentoBollaResaValida.action?codFornitore="+$("#fornitoriEdit").val()+"&dataDocumento="+$("#dataDocumentoEdit").val(),preventCache:true,handleAs:"json",headers:{"Content-Type":"application/json; charset=utf-8"},handle:function(b){unBlockUI();if(typeof b.error!=="undefined"){$.alerts.dialogClass="style_1";jAlert(b.error,msgAttenzione,function(){$.alerts.dialogClass=null})}else if(typeof b.result!==
"undefined"&&b.result.toString()==="false"){$.alerts.dialogClass="style_1";jAlert(msgDataDocumentoInvalida,msgAttenzione,function(){$.alerts.dialogClass=null});setTimeout(function(){$(this).val("")},100);return false}}})},200)});var a=$("#fornitoriEdit").val();$("#fornitoriEdit").change(function(){if($("#BollaResaEditTab_table > tbody tr").length>1){PlaySound("beep3");jConfirm(msgConfirmAzzerareVociBolla,attenzioneMsg,function(b){if(b){$("#BollaResaEditTab_table tbody tr:not(:last)").remove();a=$("#fornitoriEdit").val()}else $("#fornitoriEdit").val(a);
return false})}});if(bollaInviata)disableForm();else{codFornitore!=null&&$("#fornitoriEdit").val(codFornitore);$("#fornitoriEdit").focus()}bollaInviata||$("#BollaResaEditForm img[src*='pdf.gif'], #BollaResaEditForm img[src*='xls.gif']").each(function(){var b=$(this).closest("a"),d=b.attr("href").replace("javascript:","");b.attr("href","javascript: memorizzaBolla(function() {"+d+"});")})});function onCloseLayer(){if(isNew||bollaMemorizzata)$("#ricerca").trigger("click")}
function disableForm(){$("#BollaResaEditForm input:not(input[type=hidden])").each(function(){$(this).attr("disabled",true)});$("#BollaResaEditForm select").each(function(){$(this).attr("disabled",true)});$("#addRow, #deleteRow, #addFornitore").removeAttr("onclick")}
function memorizzaBolla(a){if(validateFieldsBollaResa(true)){ray.ajax();$("#BollaResaEditForm").attr("action","pneResaJ_saveBolla.action");dojo.xhrPost({form:"BollaResaEditForm",handleAs:"json",handle:function(b){$("#BollaResaEditForm").attr("action","pneResa_editBolla.action");unBlockUI();if(typeof b.error!=="undefined"){$.alerts.dialogClass="style_1";jAlert(b.error,msgAttenzione,function(){$.alerts.dialogClass=null})}else if(typeof b!=="undefined"&&typeof b.result!=="undefined"){bollaMemorizzata=
true;$("#codResa").val(b.result);$("#BollaResaEditForm input[name='idDocumento']").val(b.result);$("#isNew").val("false");if(typeof a==="function"){a();$("#BollaResaEditTab_table tbody tr:first td:nth-child(4)").find("input:text").focus()}else jAlert(okMessage,msgAvviso.toUpperCase(),function(){$("#BollaResaEditTab_table tbody tr:first td:nth-child(4)").find("input:text").focus()})}disableFields()}})}}
function memorizzaInviaBolla(){jConfirm(msgConfirmMemorizzaInviaBolla.replace("{0}",$("#fornitoriEdit :selected").text()),attenzioneMsg,function(a){if(a){if(validateFieldsBollaResa(true)){ray.ajax();$("#BollaResaEditForm").attr("action","pneResaJ_sendBolla.action");dojo.xhrPost({form:"BollaResaEditForm",handleAs:"json",handle:function(b){$("#BollaResaEditForm").attr("action","pneResa_editBolla.action");unBlockUI();if(typeof b.error!=="undefined"){$.alerts.dialogClass="style_1";jAlert(b.error,msgAttenzione,
function(){$.alerts.dialogClass=null})}else if(typeof b!=="undefined"&&typeof b.result!=="undefined"){bollaMemorizzata=true;$("#codResa").val(b.result);$("#isNew").val("false");memInviaSuccessCallback();disableForm()}}})}}else setTimeout(function(){unBlockUI()},200);return false},true,false)}
function memInviaSuccessCallback(){blockUIForDownload();document.forms.BollaResaEditForm.ec_eti.value="";$("#BollaResaEditForm").attr("action","reportPne_reportBollaResaProdottiVariPdf.action?idDocumento="+$("#codResa").val());$("#BollaResaEditForm").submit()}
function finishDownloadCallback(){if(memInvBollaResaPressed){dojo.xhrGet({url:appContext+"/pneResaJ_getReportBollaResaFileName.action?idDocumento="+$("#codResa").val(),preventCache:true,handleAs:"json",headers:{"Content-Type":"application/json; charset=utf-8"},handle:function(a){setTimeout(function(){unBlockUI()},200);if(typeof a.result!=="undefined"){$("#printLink").attr("href","/bolle_resa_prodotti_vari/"+codFiegDl+"/"+codEdicolaMaster+"/"+a.result);$("#butDiv").html($("#printDiv").css({visibility:"visible"}))}}});
memInvBollaResaPressed=false}document.forms.BollaResaEditForm.ec_eti.value=""}
function disableFields(){$("#BollaResaEditTab_table tbody tr").each(function(){var a=$(this);if(!a.hasClass("calcRow")){a.find("td:nth-child(1)").find("input:text").attr("disabled",true);a.find("td:nth-child(5)").find("input:text").attr("disabled",true);a.find("td:nth-child(6)").find("input:text").attr("disabled",true);a.find("td:nth-child(7)").find("select").attr("disabled",true);a.find("td:nth-child(8)").find("input:text").attr("disabled",true)}})}
function setTableFields(){var a=0;$("#BollaResaEditTab_table tbody tr").each(function(){var b=$(this);if(!b.hasClass("calcRow")){b.append('<input name="dettagli['+a+'].prodotto.edicola.codEdicola" value="'+userId+'" type="hidden">');var d=b.find("td").first().find("input[id*='prog']").val();attachEventsToRow(b,d);a++}})}
function removeTableRow(){if(bollaInviata)return false;if($("#"+lastFocusedFieldId.replace(/([|@.\[\]])/g,"\\$1")).length>0){var a=$("#"+lastFocusedFieldId.replace(/([|@.\[\]])/g,"\\$1")).closest("tr");if(a.hasClass("odd")||a.hasClass("even"))a.remove()}else $("#BollaResaEditTab_table > tbody tr:last").prev().remove();updateTotal()}function getIvaOptions(){for(var a="",b=numbersStr.split(","),d=0;d<b.length;d++)a+='<option value="'+b[d]+'">'+b[d]+"</option>";return a}
function addTableRow(){if(bollaInviata)return false;$("#BollaResaEditTab_table > tbody tr td:nth-child(2)").find("img").each(function(){$(this).remove()});var a=$("#BollaResaEditTab_table > tbody tr").length,b='<tr class="odd" style="height:22px"><td style="text-align: left;" width="8%"><input name="dettagli['+a+'].codiceProdottoFornitore" id="codiceProdottoFornitore'+a+'" value="" style="text-align: left;" size="6" maxlength="10" type="text"></td>';b+='<td style="text-align: left;" width="14%; white-space: nowrap;"><input name="dettagli['+
a+'].prodotto.barcode" id="barcode'+a+'" value="" style="text-align: left; vertical-align:middle" size="23" maxlength="20" type="text"></td>';b+='<td width="30%"></td>';b+='<td width="8%" style="text-align: left;"><input name="dettagli['+a+'].quantita" id="quant'+a+'" value="" style="text-align: left;" size="3" maxlength="10" type="text"></td>';b+='<td style="text-align: left;" width="8%"><input name="dettagli['+a+'].prezzo" id="prezzo'+a+'" value="" style="text-align: right;" size="8" maxlength="10" type="text" disabled="true"></td>';
b+='<td style="text-align: left;" width="8%"><input name="dettagli['+a+'].importo" id="importo'+a+'" value="" style="text-align: right;" size="8" maxlength="10" type="text" disabled="true"></td>';b+='<td style="text-align: left;" width="8%"><select name="dettagli['+a+'].prodotto.aliquota" id="aliquota'+a+'" value="" style="text-align:center; font-size: 14px; width: 60px;" disabled="true">'+getIvaOptions()+"</select></td>";b+='<td style="text-align: left;" width="8%"><input name="dettagli['+a+'].giacenzaProdotto" id="giacenzaProdotto'+
a+'" value="" style="text-align:center;" size="2" type="text" disabled="true"></td>';b+='<input name="dettagli['+a+'].pk.progressivo" id="prog'+a+'" value="" type="hidden">';b+='<input name="dettagli['+a+'].pk.idDocumento" id="idDoc'+a+'" value="" type="hidden">';b+='<input name="dettagli['+a+'].prodotto.codProdottoInterno" id="prodInterno'+a+'" value="" type="hidden">';b+='<input name="dettagli['+a+'].prodotto.edicola.codEdicola" value="'+userId+'" type="hidden">';b+='<input name="dettagli['+a+'].prodotto.descrizioneProdottoA" id="descrizioneProdottoA'+
a+'" value="" type="hidden">';b+='<input name="dettagli['+a+'].prodotto.percentualeResaSuDistribuito" id="percentualeResaSuDistribuito'+a+'" value="" type="hidden">';b+="</tr>";if($("#"+lastFocusedFieldId).length>0&&$("#"+lastFocusedFieldId).attr("name").indexOf("dettagli")!=-1){var d=$("#"+lastFocusedFieldId).closest("tr");if(d.hasClass("odd")||d.hasClass("even"))d.after(b)}else $("#BollaResaEditTab_table tbody tr:last").before(b);$("#product").tooltip({delay:0,showURL:false});$("#codProdottoInterno0").attr("disabled",
true);setLastFocusedElement();$("#codiceProdottoFornitore"+a).focus();attachEventsToRow($("#codiceProdottoFornitore"+a).closest("tr"),a);setFocusedFieldStyle()}
function attachEventsToRow(a,b){var d=a.find(":input").first(),j=a.find("td:nth-child(2)").find(":input").first(),k=a.find("td:nth-child(4)").find(":input").first(),r=a.find("td:nth-child(5)").find(":input").first(),q=a.find("td:nth-child(6)").find(":input").first(),m=a.find("td:nth-child(7)").find(":input").first(),u=$("#descrizioneProdottoA"+b);r.numeric({decimal:",",negative:false});d.autocomplete({minLength:2,search:function(){if(allowSearch){ray.ajax();return true}else return false},source:function(c,
f){dojo.xhrGet({url:appContext+"/automcomplete_getProdottoNonEditorialeInBolla.action?codFornitore="+$("#fornitoriEdit").val()+"&soloProdottiForniti=true",delay:100,preventCache:true,handleAs:"json",headers:{"Content-Type":"application/json; charset=utf-8"},content:{term:c.term},handle:function(g){setTimeout(function(){unBlockUI()},200);if(g.length==0)focusNextField();else if(g.length==1){var e=d.closest("td"),h=e.next(),s=e.closest("tr").find(":input:hidden[name*='prodotto.codProdottoInterno']"),
n=e.closest("tr").find(":input:hidden[name*='prodotto.percentualeResaSuDistribuito']");h=h.find(":input");e=e.next().next();var i=e.next().next(),o=i.find(":input"),t=i.next().find(":input"),v=i.next().next().find("select");i=i.next().next().next().find(":input");h.val(g[0].barcode);s.val(g[0].codProdotto);n.val(g[0].percentualeResaSuDistribuito);o.val(displayNum(Number(g[0].prezzo).toFixed(2)));h.attr("disabled",true);e.html(g[0].descrizione);v.val(g[0].iva);v.attr("oldVal",g[0].iva);g[0].iva!=""?
v.attr("disabled",true):v.attr("disabled",false);i.val(g[0].giacenza);d.attr("oldVal",d.val());d.attr("disabled",true);o.attr("disabled",true);t.attr("disabled",true);i.attr("disabled",true);setTimeout(function(){$("#"+lastFocusedFieldId).closest("td").next().next().next().find(":input").focus()},100)}else f($.map(g,function(l){return{id:l.codProdotto,label:l.codiceFornitore+" - "+l.descrizione,descrizione:l.descrizione,value:l.codiceFornitore,prezzo:l.prezzo,barcode:l.barcode,iva:l.iva,prodottoDl:l.prodottoDl,
percentualeResaSuDistribuito:l.percentualeResaSuDistribuito,giacenza:l.giacenza}}))}})},select:function(c,f){var g=d.closest("td"),e=g.next(),h=g.closest("tr").find(":input:hidden[name*='prodotto.codProdottoInterno']"),s=g.closest("tr").find(":input:hidden[name*='prodotto.percentualeResaSuDistribuito']");e=e.find(":input");g=g.next().next();var n=g.next().next(),i=n.find(":input"),o=n.next().find(":input"),t=n.next().next().find("select");n=n.next().next().next().find(":input");e.val(f.item.barcode);
h.val(f.item.id);s.val(f.item.percentualeResaSuDistribuito);i.val(displayNum(Number(f.item.prezzo).toFixed(2)));i.attr("disabled",true);e.attr("disabled",true);g.html(f.item.descrizione);t.val(f.item.iva);t.attr("oldVal",f.item.iva);n.val(f.item.giacenza);f.item.iva!=""?t.attr("disabled",true):t.attr("disabled",false);d.attr("oldVal",d.val());d.attr("disabled",true);i.attr("disabled",true);o.attr("disabled",true);setTimeout(function(){$("#"+lastFocusedFieldId).closest("td").next().next().next().find(":input").focus()},
100)}});d.keypress(function(c){if((c.keyCode?c.keyCode:c.charCode)==13){c.preventDefault();allowSearch=true}});d.focus(function(){$(this).val()==""&&j.attr("disabled",false)});d.keyup(function(){$(this).val()==""&&j.attr("disabled",false)});k.numeric({decimal:false,negative:false});k.keypress(function(c){if((c.keyCode?c.keyCode:c.charCode)==13){c.preventDefault();focusNextField();calcImporto($(this),q,r)}});r.keypress(function(c){if((c.keyCode?c.keyCode:c.charCode)==13){c.preventDefault();focusNextField();
try{calcImporto(k,q,$(this));$(this).val(displayNum($(this).val()))}catch(f){setTimeout('$("#'+prodFieldId+'")[0].focus();',100)}}});r.blur(function(){var c=$(this).attr("id");try{calcImporto(k,q,$(this));$(this).val(displayNum($(this).val()))}catch(f){setTimeout('$("#'+c+'")[0].focus();',100)}});q.keypress(function(c){if((c.keyCode?c.keyCode:c.charCode)==13){c.preventDefault();focusNextField()}});m.keypress(function(c){if((c.keyCode?c.keyCode:c.charCode)==13){c.preventDefault();addTableRow()}});
j.keypress(function(c){c=c.keyCode?c.keyCode:c.charCode;if(!isNaN($(this).val().trim())&&c==13)allowSearch=true});j.autocomplete({minLength:3,search:function(){if(isNaN($(this).val().trim())||allowSearch){allowSearch=false;ray.ajax();return true}else return false},source:function(c,f){var g=j.val();dojo.xhrGet({url:appContext+"/pubblicazioniRpc_getPneBarcodeOrDescrizione.action?barcode="+g+"&codFornitore="+$("#fornitoriEdit").val()+"&soloProdottiForniti=true",delay:100,preventCache:true,handleAs:"json",
headers:{"Content-Type":"application/json; charset=utf-8"},content:{term:c.term},handle:function(e){setTimeout(function(){unBlockUI()},200);if(e.length==1){var h=d.closest("td"),s=h.next(),n=h.closest("tr").find(":input:hidden[name*='prodotto.codProdottoInterno']"),i=h.closest("tr").find(":input:hidden[name*='prodotto.percentualeResaSuDistribuito']");s=s.find(":input");var o=h.next().next();h=h.find(":input");var t=o.next().next().find(":input"),v=o.next().next().next().find(":input"),l=o.next().next().next().next().find("select"),
w=o.next().next().next().next().next().find(":input");s.val(e[0].barcode);n.val(e[0].codProdotto);i.val(e[0].percentualeResaSuDistribuito);o.html(e[0].descrizione);t.val(displayNum(Number(e[0].ultimoPrezzoAcquisto).toFixed(2)));t.attr("disabled",true);l.val(e[0].iva);l.attr("oldVal",e[0].iva);e[0].iva!=""?l.attr("disabled",true):l.attr("disabled",false);v.attr("disabled",true);u.val(e[0].descrizione);if(e[0].codiceProdottoFornitore.length>0){h.val(e[0].codiceProdottoFornitore);h.attr("oldVal",e[0].codiceProdottoFornitore);
h.attr("disabled",true)}w.val(e[0].giacenza);$("#"+lastFocusedFieldId).closest("td").next().next().find(":input").focus()}else e.length>1&&f($.map(e,function(p){return{id:p.codProdotto,label:p.barcode+" - "+p.descrizione,descrizione:p.descrizione,value:p.barcode,barcode:p.barcode,iva:p.iva,codiceProdottoFornitore:p.codiceProdottoFornitore,ultimoPrezzoAcquisto:p.ultimoPrezzoAcquisto,prodottoDl:p.prodottoDl,percentualeResaSuDistribuito:p.percentualeResaSuDistribuito,giacenza:p.giacenza}}))}})},select:function(c,
f){var g=d.closest("td"),e=g.next().next(),h=g.closest("tr").find(":input:hidden[name*='prodotto.codProdottoInterno']"),s=g.closest("tr").find(":input:hidden[name*='prodotto.percentualeResaSuDistribuito']");g=g.find(":input");var n=e.next().next().next().find(":input"),i=e.next().next().next().next().find("select"),o=e.next().next().next().next().next().find(":input");h.val(f.item.id);s.val(f.item.percentualeResaSuDistribuito);e.html(f.item.descrizione);e=e.next().next().find(":input");e.val(displayNum(Number(f.item.ultimoPrezzoAcquisto).toFixed(2)));
e.attr("disabled",true);n.attr("disabled",true);i.val(f.item.iva);i.attr("oldVal",f.item.iva);f.item.iva!=""?i.attr("disabled",true):i.attr("disabled",false);u.val(f.item.descrizione);if(f.item.codiceProdottoFornitore.length>0){g.val(f.item.codiceProdottoFornitore);g.attr("oldVal",f.item.codiceProdottoFornitore);g.attr("disabled",true)}o.val(f.item.giacenza);setTimeout(function(){$("#"+lastFocusedFieldId).closest("td").next().next().find(":input").focus()},100)}});validateQuantitaReso=function(c){var f=
c.closest("td").closest("tr"),g=f.find(":input:hidden[name*='prodotto.codProdottoInterno']").val();f=f.find(":input:hidden[name*='prodotto.percentualeResaSuDistribuito']").val();if(c.val().trim().length>0)if(Number(f)===0){$.alerts.dialogClass="style_1";jAlert($.validator.format(msgResaNonConsentita,[u.val()]),msgAttenzione,function(){$.alerts.dialogClass=null});setTimeout(function(){c.val("")},100);return false}else dojo.xhrGet({url:appContext+"/pneResaJ_isQuantitaResoValida.action?reso="+c.val()+
"&idProdotto="+g,preventCache:true,handleAs:"json",headers:{"Content-Type":"application/json; charset=utf-8"},handle:function(e){setTimeout(function(){unBlockUI()},200);if(typeof e.error!=="undefined"){$.alerts.dialogClass="style_1";jAlert(e.error,msgAttenzione,function(){$.alerts.dialogClass=null})}else if(typeof e.result!=="undefined"&&e.result.toString()==="false"){$.alerts.dialogClass="style_1";jAlert($.validator.format(msgQtaResoInvalida,[u.val()]),msgAttenzione,function(){$.alerts.dialogClass=
null});setTimeout(function(){c.val("")},100);return false}}})};k.blur(function(){var c=$(this).attr("id");try{hasMemorizzaInvia&&validateQuantitaReso($(this));calcImporto($(this),q,r)}catch(f){setTimeout('$("#'+c+'")[0].focus();',100)}})}
function calcImporto(a,b,d){var j=0;try{j=Number(parseLocalNum($(a).val())).toFixed(2)}catch(k){throw k;}a=0;try{a=Number(parseLocalNum($(d).val())).toFixed(2)}catch(r){throw r;}if(!isNaN(j)&&!isNaN(a)){d=Number(j*a);$(b).val(displayNum(d.toFixed(2)));updateTotal()}}
function updateTotal(){var a=$("#BollaResaEditTab_table tbody tr.calcRow td.calcResult"),b=0;$("#BollaResaEditTab_table tbody tr td:nth-child(6)").each(function(){var d=$(this).find(":input:text");if(d.length>0){d=Number(parseLocalNum(d.val()));b+=d}});a.text(displayNum(b.toFixed(2)))}function focusNextField(){$("#"+lastFocusedFieldId).closest("td").next().find(":input").focus().select()}
function doDelete(){PlaySound("beep3");jConfirm(msgCancellareBolla,attenzioneMsg,function(a){if(a){$("#numeroDocumentoEdit").attr("disabled",false);setFormAction("BollaResaEditForm","pneResa_deleteBolla.action","","messageDiv",true,null,function(){$("#ricerca").trigger("click")},null,false);deleted=true;setTimeout("unBlockUI();",100)}else{setTimeout("unBlockUI();",100);return false}})}
function validateFieldsBollaResa(a){if($("#fornitoriEdit").val()==""){if(a){$.alerts.dialogClass="style_1";jAlert(msgCampoObbligatorio.replace("{0}",msgFornitore),msgAttenzione,function(){$.alerts.dialogClass=null})}setTimeout(function(){unBlockUI()},200);return false}if($("#dataDocumentoEdit").val()==""){if(a){$.alerts.dialogClass="style_1";jAlert(msgCampoObbligatorio.replace("{0}",msgDataDocumento),msgAttenzione,function(){$.alerts.dialogClass=null})}setTimeout(function(){unBlockUI()},200);return false}else if(!checkDate($("#dataDocumentoEdit").val())){if(a){$.alerts.dialogClass=
"style_1";jAlert(msgFormatoDataInvalido.replace("{0}",$("#dataDocumentoEdit").val()),msgAttenzione,function(){$.alerts.dialogClass=null})}setTimeout(function(){unBlockUI()},200);return false}if($("#numeroDocumentoEdit").val()==""){if(a){$.alerts.dialogClass="style_1";jAlert(msgCampoObbligatorio.replace("{0}",msgNumeroDocumento),msgAttenzione,function(){$.alerts.dialogClass=null})}setTimeout(function(){unBlockUI()},200);return false}var b=0;try{var d=[];$("#BollaResaEditTab_table tbody tr:not(:last)").each(function(){var k=
$(this).find("td:nth-child(3)").text().trim();if(k.length==0){if(a){$.alerts.dialogClass="style_1";jAlert(msgErrorProdotto,msgAttenzione,function(){$.alerts.dialogClass=null})}var r=$(this).find("td:nth-child(2)").find(":input:text").attr("id");setTimeout(function(){unBlockUI()},200);throw r;}$(this).find("input[name*='dettagli'], select[name*='dettagli']").each(function(){var q=$(this).attr("name"),m=$(this).attr("id");q.indexOf("codProdottoInterno")!=-1&&d.push($(this).val());if(m.indexOf("quant")!=
-1&&$(this).val()==""){if(a){$.alerts.dialogClass="style_1";jAlert(msgCampoObbligatorio.replace("{0}",msgQuantita),msgAttenzione,function(){$.alerts.dialogClass=null})}setTimeout(function(){unBlockUI()},200);throw m;}else if(m.indexOf("quant")!=-1&&Number($(this).val())>1E3){if(a){$.alerts.dialogClass="style_1";jAlert(numeroNonValido,msgAttenzione,function(){$.alerts.dialogClass=null})}setTimeout(function(){unBlockUI()},200);throw m;}m.indexOf("aliquota")!=-1&&$(this).val().trim()!=""&&$(this).attr("disabled",
false);m.indexOf("prezzo")!=-1&&$(this).val().trim()!=""&&$(this).attr("disabled",false);m.indexOf("importo")!=-1&&$(this).val().trim()!=""&&$(this).attr("disabled",false);var u=q.indexOf("["),c=q.indexOf("]")+1;u=q.substring(u,c);$(this).attr("name",q.replace(u,"["+b+"]"));m.indexOf("prog")!=-1&&$(this).val(b);m.indexOf("idDoc")!=-1&&$(this).val($("#codResa").val());m.indexOf("descrizioneProdottoA")!=-1&&$(this).val(k)});b++});if(findDuplicates(d).length>0){if(a){$.alerts.dialogClass="style_1";jAlert(msgProdottiDuplicatiBolla,
msgAttenzione,function(){$.alerts.dialogClass=null})}setTimeout(function(){unBlockUI()},200);return false}}catch(j){$("#"+j.toString()).focus();return false}$("#dataDocumentoEdit").removeAttr("disabled");$("#numeroDocumentoEdit").removeAttr("disabled");enableAllFormFields();byPassCodiceProdottoFornitoreCheck=byPassAliquotaCheck=false;return true}function addForn(){openDiv("popup_name_det",900,350,appContext+"/pneFornitori_editFornitore.action","","det","");return false}
function nuovoProdottoSuccessCallback(){var a=$("#product").prev("input:text"),b=a.closest("tr"),d=b.find(":input").first().closest("td").next().next(),j=b.find("input[id^='prodInterno']").first();b=b.find("input[id^='descrizioneProdottoA']").first();a.val($("#prodottoEdicola\\.barcode").val());j.val($("#prodottoEdicola\\.codProdottoInterno").val());b.val($("#prodottoEdicola\\.descrizioneProdottoA").val());d.html($("#prodottoEdicola\\.descrizioneProdottoA").val());$("#closedet").trigger("click");
setTimeout(function(){$("#"+a.attr("id")).closest("td").next().next().find(":input").focus()},100)}
function afterSuccessSaveFromBollaResa(a){$("#closedet").trigger("click");dojo.xhrGet({url:appContext+"/pubblicazioniRpc_getFornitori.action",handleAs:"json",headers:{"Content-Type":"application/json; charset=utf-8"},preventCache:true,handle:function(b){b=JSON.parse(b);for(var d="",j="",k=0;k<b.length;k++){j=a==b[k].value?"selected":"";d+="<option "+j+' value="'+b[k].key+'">'+b[k].value+"</option>"}$("#fornitoriEdit").empty();$("#fornitoriEdit").html(d);$("#fornitoriEdit").trigger("change")}})}
function addProduct(a){var b="";if(typeof a!="undefined"&&a!="")b="?descrizioneProdotto="+escape(a);openDiv("popup_name_det",800,500,appContext+"/pne_editProdottoEdicolaContent.action"+b,"","det","");return false}function closeLayerConfirm(){jConfirm(msgConfirmCloseDialog,attenzioneMsg,function(a){a&&$("#close").trigger("click")},true,false)};