$(document).ready(function(){addFadeLayerEvents();$("#BollaResaFuoriVoceForm input:text[name^='resoFuoriVoce']").each(function(){var a=$(this);a.numeric(false);var e=a.val().trim();a.data("oldVal",e)});thumbnailviewer.init();$("#BollaResaFuoriVoceForm input[name='resoFuoriVoce']:first").focus()});
function afterSaveResaFuoriVoce(){var a="",e=[],h=0;$($("#BollaResaFuoriVoceForm input:text[name^='resoFuoriVoce']").get().reverse()).each(function(){var d=$("input:hidden[name='cpu']").val(),c=$(this),r=c.attr("id"),f=c.val(),q=c.attr("id"),k=c.attr("id"),b=c.parent().parent(),m=q.split("|")[4],l=[],v=[],w=0,x=false;q=false;$("#BollaResaTab_table tbody tr[divParam]").each(function(){var o=$(this).attr("divParam").split("?")[1].split("&")[0].split("=")[1];if(Number(o)==Number(d)){var s=$(this);l[w]=
s;o=s.find("input:text[name^='reso']");v[w]=o.attr("id");var t=o.attr("id");if(Number(t.split("|")[4])==Number(r.split("|")[4])){s=s.find("td:nth-child(8)").html().trim();t=t.replace("reso","").replace("resoFuoriVoce","");updateHiddenFields(t,o.val(),s);o.val(f);o.attr("isnewfield","false");e[h]=t;h++;x=true;return false}w++}});if(!x&&l.length>0){var i=0,p=0;for(c=0;c<l.length;c++){var n=v[c].split("|")[4];if(c==0)p=n;if(Number(n)<Number(m)&&Number(n)>Number(i))i=n}if(i==0&&p>0){i=p;q=true}for(c=
0;c<l.length;c++){m=b.clone();n=v[c].split("|")[4];if(n==i){i=l[c].attr("divparam").split("&")[0].split("=")[1];n=l[c].find("td:nth-child(14)").html();p=l[c].find("td:nth-child(15)").html();b=m.find("td:nth-child(6)").html().trim();i=getRowHtml(m,i,n,p,k,f,false);if(f!=null&&f!="")a+=addExtraHiddenFields(k,f,b);if(f!=""&&Number(f)>0){q?$(i).insertBefore(l[c]):$(i).insertAfter(l[c]);$("#content1").css({height:$("#BollaResaForm").height()+30+"px"});e[h]=k.replace("reso","").replace("resoFuoriVoce",
"");h++;thumbnailviewer.init()}break}}}else if(!x){m=b.clone();p=$(m).find("td:nth-child(10)").html();i=getRowHtml(m,d,"",p,k,f,false);b=m.find("td:nth-child(6)").html().trim();if(f!=null&&f!="")a+=addExtraHiddenFields(k,f,b);if(f!=""&&Number(f)>0){$(i).insertBefore($("#BollaResaTab_table tbody tr:last"));$("#content1").css({height:$("#BollaResaForm").height()+30+"px"});e[h]=k.replace("reso","").replace("resoFuoriVoce","");h++;thumbnailviewer.init()}}});var u=0;$("#BollaResaTab_table tbody tr[divParam]").each(function(){var d;
d=u%2==0?"even":"odd";$(this).removeClass("odd").removeClass("even").addClass(d);$(this).mouseout(function(){$(this).removeClass(d).addClass(d=="even"?"odd":"even")});u++});a!=""&&$("#extraHidden").append(a);for(var g=0;g<e.length;g++){var j=document.getElementById("reso"+e[g]);$(j).keydown(focusBarcodeField);if(g==0)lastFieldFocusId="reso"+e[g];setTotals(j,true)}setOnChangeEventOnTextFields();setBorderToFuoriVoce();deleteEmptyRowsFuoriVoce();setFocusedFieldStyle();g=$("#BollaResaTab_table tbody").find("td:nth-child(3)");
g.unbind("click",tableRowClick);g.css("cursor","pointer").click(tableRowClick);doCloseLayer(function(){if(lastFieldFocusId!=""){var d=lastFieldFocusId.replace(/([|@])/g,"\\$1");d=$("#"+d);if(!d.is(":disabled")){setLastFocusedElement();d.focus();return false}}})}
function getRowHtml(a,e,h,u,g,j,d){j=isNaN(j)?"":Number(j);var c=isNaN(parseLocalNum(a.find("td:nth-child(8)").text().trim()))?"":Number(parseLocalNum(a.find("td:nth-child(8)").text().trim())).toFixed(2),r=isNaN(parseLocalNum(a.find("td:nth-child(9)").text().trim()))?"":Number(parseLocalNum(a.find("td:nth-child(9)").text().trim())).toFixed(4),f=!d?j==""||c==""?"":(Number(j)*Number(c)).toFixed(2):0,q=!d?j==""||r==""?"":(Number(j)*Number(r)).toFixed(4):0,k=g.replace("resoFuoriVoce","").replace("reso",
"");g=g.replace("resoFuoriVoce","reso");var b="<tr class='odd' style='height: 30px;' onmouseover='this.className=\"highlight\"' onmouseout='this.className=\"odd\"' divparam='#?cpu="+e+"' iv='' pv=''>";b+="<td width='2%'>&nbsp;</td>";b+="<td style='text-align: center;' width='4%'>"+e+"</td>";b+="<td style='cursor: pointer;' width='16%'>"+a.find("td:nth-child(1)").html()+"</td>";b+="<td width='12%'>"+a.find("td:nth-child(2)").html()+"</td>";b+="<td style='text-align: center;' width='4%'>"+a.find("td:nth-child(3)").html()+
"</td>";b+="<td style='text-align: center;' width='5%'>"+a.find("td:nth-child(4)").html()+"</td>";b+="<td class='extremeTableFieldsSmaller' style='font-size: 120%; font-weight: bold; text-align: right; border-width: 1px medium; border-style: solid none; border-color: red -moz-use-text-color;' width='5%'><input name='resoFuoriVoce[&#39;"+k+"&#39;]' id='"+g+"' value='"+j+"' class='extremeTableFieldsSmaller' isContoDeposito='"+d+"' style='font-size:120%; font-weight:bold; text-align:right; border-color: rgb(153, 153, 153);' size='2' maxlength='3' validateisnumeric='true' isnewfield='true' type='text'><input type='hidden' name='modificatoFV[&#39;"+
k+"&#39;]' id='modificatoFV"+k+"' value='false'/></td>";b+="<td style='text-align: center;' width='5%'>"+a.find("td:nth-child(6)").html()+"</td>";b+="<td style='text-align: center;' class='extremeTableFieldsSmaller' style='text-align: right;' width='8%'>"+a.find("td:nth-child(7)").html()+"</td>";b+="<td style='text-align: right;' width='6%'>"+displayNum(c)+"</td>";b+="<td style='text-align: right;' width='6%'>"+displayNum(r)+"</td>";b+="<td style='text-align: right;' width='7%'>"+f+"</td>";b+="<td style='text-align: right;' width='7%'>"+
q+"</td>";b+="<td style='text-align: center;' width='8%'>"+h+"</td>";b+="<td style='text-align: center;' width='3%'>"+u+"</td>";b+="</tr>";return b}function addExtraHiddenFields(a,e,h){a=a.replace("reso","").replace("resoFuoriVoce","");return"<input type='hidden' id='reso_old_"+a+"' value='"+e+"'/>"+("<input type='hidden' id='giacenza_old_"+a+"' value='"+h+"'/>")}function updateHiddenFields(a,e,h){document.getElementById("reso_old_"+a).value=e;document.getElementById("giacenza_old_"+a).value=h};